const t={wrapperAttr:"wrapper",noAjaxLinkAttr:"no-ajax-link",noPrefetchAttr:"no-prefetch",headers:[["x-partial","true"]],preventSelfAttr:'prevent="self"',preventAllAttr:'prevent="all"',transitionAttr:"transition",blockAttr:"block",timeout:3e4};class e{constructor(e){this.config=Object.assign({...t},e)}toAttr(t,e=!0){let{prefix:i}=this.config,s=`data${i?"-"+i:""}-${t}`;return e?`[${s}]`:s}getConfig(t,e=!0){if("string"!=typeof t)return this.config;let i=this.config[t];return"string"==typeof i?this.toAttr(i,e):i}}class i{constructor(t){this.map=new Map(t)}getMap(){return this.map}get(t){return this.map.get(t)}keys(){return[...this.map.keys()]}values(){return[...this.map.values()]}set(t,e){return this.map.set(t,e),this}add(t){return this.set(this.size,t),this}get size(){return this.map.size}last(t=1){let e=this.keys()[this.size-t];return this.get(e)}prev(){return this.last(2)}delete(t){return this.map.delete(t),this}clear(){return this.map.clear(),this}has(t){return this.map.has(t)}entries(){return this.map.entries()}forEach(t=((...t)=>{}),e){return this.map.forEach(t,e),this}[Symbol.iterator](){return this.entries()}methodCall(t,...e){return this.forEach(i=>{i[t](...e)}),this}async asyncMethodCall(t,...e){for await(let[,i]of this.map)await i[t](...e);return this}}class s{constructor(){}getConfig(t,e){return this.manager.getConfig(t,e)}install(){}register(t){return this.manager=t,this.install(),this}}class r extends i{constructor(t){super(),this.app=t}set(t,e){return super.set(t,e),"function"==typeof e.register&&e.register(this),this}getApp(){return this.app}getConfig(...t){return this.app.getConfig(...t)}}class n extends URL{constructor(t=window.location.href){super(t instanceof URL?t.href:t,window.location.origin)}getFullPath(){return`${this.pathname}${this.hash}`}getHash(){return this.hash.slice(1)}clean(){return this.toString().replace(/(\/#.*|\/|#.*)$/,"")}getPathname(){return this.pathname}equalTo(t){return this.clean()==t.clean()}static equal(t,e){let i=t instanceof n?t:new n(t),s=e instanceof n?e:new n(e);return i.equalTo(s)}}const o=new n,a=o.getPathname();class h{constructor(t=window.scrollX,e=window.scrollY){this.x=t,this.y=e}}class l{constructor(t={url:new n,index:0,transition:"default",data:{scroll:new h,trigger:"HistoryManager"}}){this.state=t}getIndex(){return this.state.index}setIndex(t){return this.state.index=t,this}getURL(){return this.state.url}getURLPathname(){return this.state.url.getPathname()}getTransition(){return this.state.transition}getData(){return this.state.data}toJSON(){const{url:t,index:e,transition:i,data:s}=this.state;return{url:t.getFullPath(),index:e,transition:i,data:s}}}class c extends i{constructor(){super()}add(t){let e=t,i=this.size;return super.add(e),e.setIndex(i),this}addState(t){let e=t instanceof l?t:new l(t);return this.add(e),this}}const g=new DOMParser;class u extends s{constructor(t=new n,e=document){super(),this.url=t,this.dom="string"==typeof e?g.parseFromString(e,"text/html"):e||document;const{title:i,head:s,body:r}=this.dom;this.title=i,this.head=s,this.body=r}install(){this.wrapper=this.body.querySelector(this.getConfig("wrapperAttr"))}getURL(){return this.url}getPathname(){return this.url.pathname}getTitle(){return this.title}getHead(){return this.head}getBody(){return this.body}getWrapper(){return this.wrapper}getDOM(){return this.dom}}class d extends r{constructor(t){super(t),this.loading=new i,this.set(a,new u)}getLoading(){return this.loading}async load(t=new n){let e,i,s=t instanceof URL?t:new n(t),r=s.getPathname();if(this.has(r))return e=this.get(r),Promise.resolve(e);this.loading.has(r)?i=this.loading.get(r):(i=this.request(r),this.loading.set(r,i));let o=await i;return this.loading.delete(r),e=new u(s,o),this.set(r,e),e}async request(t){const e=new Headers(this.getConfig("headers")),i=window.setTimeout(()=>{throw window.clearTimeout(i),"Request Timed Out!"},this.getConfig("timeout"));try{let s=await fetch(t,{mode:"same-origin",method:"GET",headers:e,cache:"default",credentials:"same-origin"});if(window.clearTimeout(i),s.status>=200&&s.status<300)return await s.text();throw new Error(s.statusText||""+s.status)}catch(t){throw window.clearTimeout(i),t}}}class p{constructor({callback:t=(()=>{}),scope:e=null,name:i="event"}){this.listener={callback:t,scope:e,name:i}}getCallback(){return this.listener.callback}getScope(){return this.listener.scope}getEventName(){return this.listener.name}toJSON(){return this.listener}}class m extends i{constructor(t="event"){super(),this.name=t}}class f extends i{constructor(){super()}getEvent(t){let e=this.get(t);return e instanceof m?e:(this.set(t,new m(t)),this.get(t))}newListener(t,e,i){let s=this.getEvent(t);return s.add(new p({name:t,callback:e,scope:i})),s}on(t,e,i){if(void 0===t)return this;let s,r,n;return"string"==typeof t&&(t=t.split(/\s/g)),Object.keys(t).forEach(o=>{"object"!=typeof t||Array.isArray(t)?(s=t[o],r=e,n=i):(s=o,r=t[o],n=e),this.newListener(s,r,n)},this),this}removeListener(t,e,i){let s=this.getEvent(t);if(e){let r,n=0,o=s.size,a=new p({name:t,callback:e,scope:i});for(;n<o&&(r=s.get(n),console.log(r),r.getCallback()!==a.getCallback()||r.getScope()!==a.getScope());n++);s.delete(n)}return s}off(t,e,i){if(void 0===t)return this;let s,r,n;return"string"==typeof t&&(t=t.split(/\s/g)),Object.keys(t).forEach(o=>{"object"!=typeof t||Array.isArray(t)?(s=t[o],r=e,n=i):(s=o,r=t[o],n=e),r?this.removeListener(s,r,n):this.delete(s)},this),this}once(t,e,i){if(void 0===t)return this;"string"==typeof t&&(t=t.split(/\s/g));let s=(...r)=>{this.off(t,s,i),e.apply(i,r)};return this.on(t,s,i),this}emit(t,...e){return void 0===t||("string"==typeof t&&(t=t.split(/\s/g)),t.forEach(t=>{let i=this.getEvent(t);const s=new CustomEvent(t,{detail:e});window.dispatchEvent(s),i.forEach(t=>{let{callback:i,scope:s}=t.toJSON();i.apply(s,e)})},this)),this}}class w extends s{install(){let t=this.manager.getApp();this.PageManager=t.getPages(),this.EventEmitter=t.getEmitter(),this.HistoryManager=t.getHistory(),this.ServiceManager=t.getServices(),this.TransitionManager=t.getTransitions()}boot(){}initEvents(){}stopEvents(){}stop(){this.stopEvents()}}class v extends r{constructor(t){super(t)}async boot(){await this.asyncMethodCall("boot")}initEvents(){return this.methodCall("initEvents"),this}stopEvents(){return this.methodCall("stopEvents"),this}stop(){return this.methodCall("stop"),this}}class E extends s{constructor(){super(),this.name="Transition"}init({oldPage:t,newPage:e,trigger:i}){return this.oldPage=t,this.newPage=e,this.trigger=i,this.boot(),this}boot(){}initEvents(){}stopEvents(){}stop(){this.stopEvents()}getName(){return this.name}getOldPage(){return this.oldPage}getNewPage(){return this.newPage}getTrigger(){return this.trigger}out({done:t}){t()}in({done:t}){t()}async start(t){var e=this;let i=this.oldPage.getWrapper(),s=this.newPage.getWrapper();return document.title=this.newPage.getTitle(),new Promise(async function(r){t.emit("BEFORE-TRANSITION-OUT"),await new Promise(t=>{let i=e.out({from:e.oldPage,trigger:e.trigger,done:t});i.then&&i.then(t)}),t.emit("AFTER-TRANSITION-OUT"),await new Promise(t=>{i.insertAdjacentElement("beforebegin",s),i.remove(),t()}),t.emit("BEFORE-TRANSITION-IN"),await new Promise(t=>{let i=e.in({from:e.oldPage,to:e.newPage,trigger:e.trigger,done:t});i.then&&i.then(t)}),t.emit("AFTER_TRANSITION_IN"),r()})}}class y extends r{constructor(t){super(t)}add(t){let e=t.getName();return this.set(e,t),this}async boot({name:t,oldPage:e,newPage:i,trigger:s}){let r=this.get(t);r.init({oldPage:e,newPage:i,trigger:s});let n=this.getApp().getEmitter();return await r.start(n)}initEvents(){return this.methodCall("initEvents"),this}stopEvents(){return this.methodCall("stopEvents"),this}}class P extends w{init(t,e,i,s){this.rootElement=e,this.name=t,this.selector=i,this.index=s}getRootElement(){return this.rootElement}getSelector(){return this.selector}getIndex(){return this.index}getName(){return this.name}}class b extends s{constructor(t,e){super(),this.name=t,this.block=e}getName(){return this.name}getBlock(){return this.block}}class k extends r{constructor(t){super(t),this.activeBlocks=new r(t)}init(){this.forEach(t=>{let e=t.getName(),i=t.getBlock(),s=`[${this.getConfig("blockAttr",!1)}="${e}"]`,r=[...document.querySelectorAll(s)];for(let t=0,n=r.length;t<n;t++){let n=new i;n.init(e,r[t],s,t),this.activeBlocks.set(t,n)}})}getActiveBlocks(){return this.activeBlocks}async boot(){await this.activeBlocks.asyncMethodCall("boot")}refresh(){const t=this.getApp().getEmitter();t.on("BEFORE_TRANSITION_OUT",()=>{this.stop()}),t.on("AFTER_TRANSITION_IN",()=>{this.init(),this.boot()})}initEvents(){return this.activeBlocks.methodCall("initEvents"),this.refresh(),this}stopEvents(){return this.activeBlocks.methodCall("stopEvents"),this}stop(){return this.activeBlocks.methodCall("stop"),this.activeBlocks.clear(),this}}class A{constructor(t={}){this.register(t)}register(t={}){this.config=t instanceof e?t:new e(t),this.transitions=new y(this),this.services=new v(this),this.blocks=new k(this),this.history=new c,this.pages=new d(this),this.emitter=new f;let i=(()=>{document.removeEventListener("DOMContentLoaded",i),window.removeEventListener("load",i),this.emitter.emit("READY ready")}).bind(this);return document.addEventListener("DOMContentLoaded",i),window.addEventListener("load",i),this}getConfig(...t){return this.config.getConfig(...t)}getEmitter(){return this.emitter}getBlocks(){return this.blocks}getServices(){return this.services}getPages(){return this.pages}getTransitions(){return this.transitions}getHistory(){return this.history}getBlock(t){return this.blocks.get(t)}getActiveBlock(t){return this.blocks.getActiveBlocks().get(t)}getService(t){return this.services.get(t)}getTransition(t){return this.transitions.get(t)}getState(t){return this.history.get(t)}get(t,e){switch(t.toLowerCase()){case"service":this.getService(e);break;case"transition":this.getTransition(e);break;case"state":this.getState(e);break;case"block":this.getActiveBlock(e);break;default:throw`Error: can't get type '${t}', it is not a recognized type. Did you spell it correctly.`}return this}async loadPage(t){return await this.pages.load(t)}async load(t,e){switch(t.toLowerCase()){case"page":return await this.loadPage(e);default:return Promise.resolve(this.get(t,e))}}addBlock(t){return this.blocks.add(t),this}addService(t){return this.services.add(t),this}addTransition(t){return this.transitions.add(t),this}addState(t){return this.history.addState(t),this}add(t,e){switch(t.toLowerCase()){case"service":this.addService(e);break;case"transition":this.addTransition(e);break;case"state":this.addState(e);break;case"block":this.addBlock(e);break;default:throw`Error: can't add type '${t}', it is not a recognized type. Did you spell it correctly.`}return this}async boot(){return this.blocks.init(),await this.services.boot(),await this.blocks.boot(),this.services.initEvents(),this.blocks.initEvents(),this.transitions.initEvents(),Promise.resolve(this)}stop(){return this.services.stop(),this.blocks.stop(),this.transitions.stopEvents(),this}currentPage(){let t=this.history.last();return this.pages.get(t.getURLPathname())}on(t,e){return this.emitter.on(t,e,this),this}off(t,e){return this.emitter.off(t,e,this),this}once(t,e){return this.emitter.once(t,e,this),this}emit(t,...e){return this.emitter.emit(t,...e),this}}class T extends w{constructor(){super(...arguments),this.ignoreURLs=[],this.prefetchIgnore=!1,this.isTransitioning=!1,this.stopOnTransitioning=!1,this.stickyScroll=!0,this.forceOnError=!1,this.autoScrollOnHash=!0}transitionStart(){this.isTransitioning=!0}transitionStop(){this.isTransitioning=!1}boot(){let t=new l;this.HistoryManager.add(t),this.changeState("replace",t)}getTransitionName(t){if(!t||!t.getAttribute)return null;let e=t.getAttribute(this.getConfig("transitionAttr",!1));return"string"==typeof e?e:null}validLink(t,e,i){let s=!window.history.pushState,r=!t||!i,o=e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey,a=t.hasAttribute("target")&&"_blank"===t.target,h=t.protocol!==location.protocol||t.hostname!==location.hostname,l="string"==typeof t.getAttribute("download"),c=t.hasAttribute(this.getConfig("preventSelfAttr",!1)),g=Boolean(t.closest(this.getConfig("preventAllAttr"))),u=c&&g,d=(new n).getFullPath()===new n(i).getFullPath();return!(r||s||o||a||h||l||u||d)}getHref(t){return t&&t.tagName&&"a"===t.tagName.toLowerCase()&&"string"==typeof t.href?t.href:null}getLink(t){let e=t.target,i=this.getHref(e);for(;e&&!i;)e=e.parentNode,i=this.getHref(e);if(e&&this.validLink(e,t,i))return e}onClick(t){let e=this.getLink(t);if(!e)return;if(this.isTransitioning&&this.stopOnTransitioning)return t.preventDefault(),void t.stopPropagation();let i=this.getHref(e);this.EventEmitter.emit("ANCHOR-CLICK CLICK click",t),this.go({href:i,trigger:e,event:t})}getDirection(t){return Math.abs(t)>1?t>0?"forward":"back":0===t?"popstate":t>0?"back":"forward"}force(t){window.location.assign(t)}go({href:t,trigger:e="HistoryManager",event:i}){if(this.isTransitioning&&this.stopOnTransitioning)return void this.force(t);let s,r=new n(t),o=this.HistoryManager.last(),a=o.getURL();if(!a.equalTo(r)){if(i&&i.state){this.EventEmitter.emit("POPSTATE",i);let{state:t}=i,{index:n,transition:a,data:h}=t,l=o.getIndex();if(s=a,"popstate"!==(e=this.getDirection(l-n))){let{x:t,y:e}=h.scroll;window.scroll({top:e,left:t,behavior:"smooth"})}"back"===e?(this.HistoryManager.delete(l),this.EventEmitter.emit("POPSTATE-BACK",i)):"forward"===e&&(this.HistoryManager.addState({url:r,transition:a,data:h}),this.EventEmitter.emit("POPSTATE-FORWARD",i))}else{s=this.getTransitionName(e)||"default";const t=new h,n=new l({url:r,index:this.HistoryManager.size,transition:s,data:{scroll:t}});if(this.stickyScroll){let{x:e,y:i}=t;window.scroll({top:i,left:e,behavior:"smooth"})}else window.scroll({top:0,left:0,behavior:"smooth"});this.HistoryManager.add(n),this.changeState("push",n),this.EventEmitter.emit("HISTORY-NEW-ITEM",i)}return i&&(i.stopPropagation(),i.preventDefault()),this.EventEmitter.emit("GO go",i),this.load({oldHref:a.getPathname(),href:t,trigger:e,transitionName:s})}this.hashAction(r.hash)}changeState(t,e){let i=e.getURL().getFullPath(),s=[e.toJSON(),"",i];if(window.history)switch(t){case"push":window.history.pushState.apply(window.history,s);break;case"replace":window.history.replaceState.apply(window.history,s)}}async load({oldHref:t,href:e,trigger:i,transitionName:s="default"}){try{let r,n=this.PageManager.get(t);this.EventEmitter.emit("PAGE-LOADING",{href:e,oldPage:n,trigger:i});try{try{r=await this.PageManager.load(e),this.transitionStart(),this.EventEmitter.emit("PAGE-LOAD-COMPLETE",{newPage:r,oldPage:n,trigger:i})}catch(t){throw"[PJAX] Page load error: "+t}this.EventEmitter.emit("NAVIGATION-START",{oldPage:n,newPage:r,trigger:i,transitionName:s});try{this.EventEmitter.emit("TRANSITION-START",s);let t=await this.TransitionManager.boot({name:s,oldPage:n,newPage:r,trigger:i});this.EventEmitter.emit("TRANSITION-END",{transition:t})}catch(t){throw"[PJAX] Transition error: "+t}this.EventEmitter.emit("NAVIGATION-END",{oldPage:n,newPage:r,trigger:i,transitionName:s}),this.hashAction()}catch(t){throw this.transitionStop(),t}this.transitionStop()}catch(t){this.forceOnError?this.force(e):console.error(t)}}hashAction(t=window.location.hash){if(this.autoScrollOnHash){let e=t.slice(1);if(e.length){let t=document.getElementById(e);if(t)if(t.scrollIntoView)t.scrollIntoView({behavior:"smooth"});else{let{left:e,top:i}=t.getBoundingClientRect();window.scroll({left:e,top:i,behavior:"smooth"})}}}}ignoredURL({pathname:t}){return this.ignoreURLs.length&&this.ignoreURLs.some(e=>"string"==typeof e?e===t:null!==e.exec(t))}onHover(t){var e=this;let i=this.getLink(t);if(!i)return;const s=new n(this.getHref(i)),r=s.getPathname();this.ignoredURL(s)||this.PageManager.has(r)||(this.EventEmitter.emit("ANCHOR-HOVER HOVER hover",t),async function(){try{await e.PageManager.load(s)}catch(t){console.warn("[PJAX] Prefetch error: ",t)}}())}onStateChange(t){this.go({href:window.location.href,trigger:"popstate",event:t})}bindEvents(){this.onHover=this.onHover.bind(this),this.onClick=this.onClick.bind(this),this.onStateChange=this.onStateChange.bind(this)}initEvents(){this.bindEvents(),!0!==this.prefetchIgnore&&(document.addEventListener("mouseover",this.onHover),document.addEventListener("touchstart",this.onHover)),document.addEventListener("click",this.onClick),window.addEventListener("popstate",this.onStateChange)}stopEvents(){!0!==this.prefetchIgnore&&(document.removeEventListener("mouseover",this.onHover),document.removeEventListener("touchstart",this.onHover)),document.removeEventListener("click",this.onClick),window.removeEventListener("popstate",this.onStateChange)}}class S extends w{constructor(t=[]){super(),this.routes=new i;for(const e of t)this.add(e)}add({path:t,method:e}){const i=this.parse(t);return this.routes.set(i,e),this}parsePath(t){if("string"==typeof t)return new RegExp(t,"i");if(t instanceof RegExp)return t;throw"[Router] only regular expressions and strings are accepted as paths."}isPath(t){return"string"==typeof t||t instanceof RegExp}parse(t){let e=t,i={from:/(.*)/g,to:/(.*)/g};if(this.isPath(t))i={from:t,to:/(.*)/g};else{if(!this.isPath(e.from)||!this.isPath(e.to))throw"[Router] path is neither a string, regular expression, or a { from, to } object.";i=e}let{from:s,to:r}=i;return{from:this.parsePath(s),to:this.parsePath(r)}}route(){let t=this.HistoryManager.last().getURLPathname(),e=window.location.pathname;this.routes.forEach((i,s)=>{let r=s.from,n=s.to;r.test(t)&&n.test(e)&&i({from:r.exec(t),to:n.exec(e)})})}initEvents(){this.route=this.route.bind(this),this.EventEmitter.on("READY",this.route),this.EventEmitter.on("PAGE-LOADING",this.route)}}export{r as AdvancedManager,A as App,P as Block,b as BlockIntent,k as BlockManager,e as CONFIG,t as CONFIG_DEFAULTS,h as Coords,m as Event,f as EventEmitter,c as HistoryManager,p as Listener,i as Manager,s as ManagerItem,g as PARSER,T as PJAX,u as Page,d as PageManager,S as Router,w as Service,v as ServiceManager,l as State,E as Transition,y as TransitionManager,a as URLString,n as _URL,o as newURL};
//# sourceMappingURL=api.modern.js.map
