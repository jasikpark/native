const CONFIG_DEFAULTS={wrapperAttr:"wrapper",noAjaxLinkAttr:"no-ajax-link",noPrefetchAttr:"no-prefetch",headers:[["x-partial","true"]],preventSelfAttr:'prevent="self"',preventAllAttr:'prevent="all"',transitionAttr:"transition",blockAttr:"block",timeout:3e4};class CONFIG{constructor(a){this.config=Object.assign({...CONFIG_DEFAULTS},a)}toAttr(a,b=!0){let{prefix:c}=this.config,d=`data${c?"-"+c:""}-${a}`;return b?`[${d}]`:d}getConfig(a,b=!0){if(typeof a!=="string")return this.config;let c=this.config[a];return typeof c==="string"?this.toAttr(c,b):c}}class Manager{constructor(a){this.map=new Map(a)}getMap(){return this.map}get(a){return this.map.get(a)}keys(){return Array.from(this.map.keys())}values(){return Array.from(this.map.values())}set(a,b){return this.map.set(a,b),this}add(a){return this.set(this.size,a),this}get size(){return this.map.size}last(a=1){let b=this.keys()[this.size-a];return this.get(b)}prev(){return this.last(2)}delete(a){return this.map.delete(a),this}clear(){return this.map.clear(),this}has(a){return this.map.has(a)}entries(){return this.map.entries()}forEach(a=(...c)=>{},b){return this.map.forEach(a,b),this}[Symbol.iterator](){return this.entries()}methodCall(a,...b){return this.forEach(c=>{c[a](...b)}),this}async asyncMethodCall(a,...b){for(let[,c]of this.map)await c[a](...b);return this}}class ManagerItem{constructor(){}getConfig(a,b){return this.manager.getConfig(a,b)}install(){}register(a){return this.manager=a,this.install(),this}}class AdvancedManager extends Manager{constructor(a){super();this.app=a}set(a,b){return super.set(a,b),typeof b.register==="function"&&b.register(this),this}getApp(){return this.app}getConfig(...a){return this.app.getConfig(...a)}}class _URL extends URL{constructor(a=window.location.href){super(a instanceof URL?a.href:a,window.location.origin)}getFullPath(){return`${this.pathname}${this.hash}`}getHash(){return this.hash.slice(1)}clean(){return this.toString().replace(/(\/#.*|\/|#.*)$/,"")}getPathname(){return this.pathname}equalTo(a){return this.clean()==a.clean()}static equal(a,b){let c=a instanceof _URL?a:new _URL(a),d=b instanceof _URL?b:new _URL(b);return c.equalTo(d)}}class Coords{constructor(a=window.scrollX,b=window.scrollY){this.x=a,this.y=b}}class State{constructor(a={url:new _URL(),index:0,transition:"default",data:{scroll:new Coords(),trigger:"HistoryManager"}}){this.state=a}getIndex(){return this.state.index}setIndex(a){return this.state.index=a,this}getURL(){return this.state.url}getURLPathname(){return this.state.url.getPathname()}getTransition(){return this.state.transition}getData(){return this.state.data}toJSON(){const{url:a,index:b,transition:c,data:d}=this.state;return{url:a.getFullPath(),index:b,transition:c,data:d}}}class HistoryManager extends Manager{constructor(){super()}add(a){let b=a,c=this.size;return super.add(b),b.setIndex(c),this}addState(a){let b=a instanceof State?a:new State(a);return this.add(b),this}}const PARSER=new DOMParser();class Page extends ManagerItem{constructor(a=new _URL(),b=document){super();this.url=a,typeof b==="string"?this.dom=PARSER.parseFromString(b,"text/html"):this.dom=b||document;const{title:c,head:d,body:e}=this.dom;this.title=c,this.head=d,this.body=e}install(){this.wrapper=this.body.querySelector(this.getConfig("wrapperAttr"))}getURL(){return this.url}getPathname(){return this.url.pathname}getTitle(){return this.title}getHead(){return this.head}getBody(){return this.body}getWrapper(){return this.wrapper}getDOM(){return this.dom}}class PageManager extends AdvancedManager{constructor(a){super(a);this.loading=new Manager();let b=new _URL().getPathname();this.set(b,new Page())}getLoading(){return this.loading}async load(a=new _URL()){let b=a instanceof URL?a:new _URL(a),c=b.getPathname(),d,e;if(this.has(c))return d=this.get(c),Promise.resolve(d);this.loading.has(c)?e=this.loading.get(c):(e=this.request(c),this.loading.set(c,e));let f=await e;return this.loading.delete(c),d=new Page(b,f),this.set(c,d),d}async request(a){const b=new Headers(this.getConfig("headers")),c=window.setTimeout(()=>{throw window.clearTimeout(c),"Request Timed Out!"},this.getConfig("timeout"));try{let d=await fetch(a,{mode:"same-origin",method:"GET",headers:b,cache:"default",credentials:"same-origin"});window.clearTimeout(c);if(d.status>=200&&d.status<300)return await d.text();const e=new Error(d.statusText||""+d.status);throw e}catch(d){throw window.clearTimeout(c),d}}}class Listener{constructor({callback:a=()=>{},scope:b=null,name:c="event"}){this.listener={callback:a,scope:b,name:c}}getCallback(){return this.listener.callback}getScope(){return this.listener.scope}getEventName(){return this.listener.name}toJSON(){return this.listener}}class Event extends Manager{constructor(a="event"){super();this.name=a}}class EventEmitter extends Manager{constructor(){super()}getEvent(a){let b=this.get(a);return b instanceof Event?b:(this.set(a,new Event(a)),this.get(a))}newListener(a,b,c){let d=this.getEvent(a);return d.add(new Listener({name:a,callback:b,scope:c})),d}on(a,b,c){if(typeof a=="undefined")return this;typeof a=="string"&&(a=a.split(/\s/g));let d,e,f=typeof a=="object"&&!Array.isArray(a),g=f?b:c;return f||(e=b),Object.keys(a).forEach(h=>{f?(d=h,e=a[h]):d=a[h],this.newListener(d,e,g)},this),this}removeListener(a,b,c){let d=this.get(a);if(d instanceof Event&&b){let e=0,f=d.size,g,h=new Listener({name:a,callback:b,scope:c});for(;e<f;e++){g=d.get(e);if(g.getCallback()===h.getCallback()&&g.getScope()===h.getScope())break}d.delete(e)}return d}off(a,b,c){if(typeof a=="undefined")return this;typeof a=="string"&&(a=a.split(/\s/g));let d,e,f=typeof a=="object"&&!Array.isArray(a),g=f?b:c;return f||(e=b),Object.keys(a).forEach(h=>{f?(d=h,e=a[h]):d=a[h],e?this.removeListener(d,e,g):this.delete(d)},this),this}once(a,b,c){if(typeof a=="undefined")return this;typeof a=="string"&&(a=a.split(/\s/g));let d,e,f=typeof a==="object"&&!Array.isArray(a),g=f?b:c;return f||(e=b),Object.keys(a).forEach(h=>{f?(d=h,e=a[h]):d=a[h];let i=(...j)=>{f?(d=h,e=a[h]):d=a[h],this.off(d,i,g),e.apply(g,j)};this.on(d,i,g)},this),this}emit(a,...b){return typeof a=="undefined"?this:(typeof a=="string"&&(a=a.split(/\s/g)),a.forEach(c=>{let d=this.get(c);d instanceof Event&&d.forEach(e=>{let{callback:f,scope:g}=e.toJSON();f.apply(g,b)})},this),this)}}class Service extends ManagerItem{install(){let a=this.manager.getApp();this.PageManager=a.getPages(),this.EventEmitter=a.getEmitter(),this.HistoryManager=a.getHistory(),this.ServiceManager=a.getServices(),this.TransitionManager=a.getTransitions()}boot(){}initEvents(){}stopEvents(){}stop(){this.stopEvents()}}class ServiceManager extends AdvancedManager{constructor(a){super(a)}boot(){return this.methodCall("boot"),this}initEvents(){return this.methodCall("initEvents"),this}stopEvents(){return this.methodCall("stopEvents"),this}stop(){return this.methodCall("stop"),this}}class Transition extends ManagerItem{constructor(){super();this.name="Transition"}init({oldPage:a,newPage:b,trigger:c}){return this.oldPage=a,this.newPage=b,this.trigger=c,this.boot(),this}boot(){}initEvents(){}stopEvents(){}stop(){this.stopEvents()}getName(){return this.name}getOldPage(){return this.oldPage}getNewPage(){return this.newPage}getTrigger(){return this.trigger}out({done:a}){a()}in({done:a}){a()}async start(a){let b=this.oldPage.getWrapper(),c=this.newPage.getWrapper();return document.title=this.newPage.getTitle(),new Promise(async d=>{a.emit("BEFORE_TRANSITION_OUT"),await new Promise(e=>{let f=this.out({from:this.oldPage,trigger:this.trigger,done:e});f.then&&f.then(e)}),a.emit("AFTER_TRANSITION_OUT"),await new Promise(e=>{b.insertAdjacentElement("beforebegin",c),b.remove(),e()}),a.emit("BEFORE_TRANSITION_IN"),await new Promise(e=>{let f=this.in({from:this.oldPage,to:this.newPage,trigger:this.trigger,done:e});f.then&&f.then(e)}),a.emit("AFTER_TRANSITION_IN"),d()})}}class TransitionManager extends AdvancedManager{constructor(a){super(a)}add(a){let b=a.getName();return this.set(b,a),this}async boot({name:a,oldPage:b,newPage:c,trigger:d}){let e=this.get(a);e.init({oldPage:b,newPage:c,trigger:d});let f=this.getApp().getEmitter();return await e.start(f)}initEvents(){return this.methodCall("initEvents"),this}stopEvents(){return this.methodCall("stopEvents"),this}}class Block extends Service{init({name:a,rootElement:b,selector:c,index:d}){this.rootElement=b,this.name=a,this.selector=c,this.index=d}getRootElement(){return this.rootElement}getSelector(){return this.selector}getIndex(){return this.index}getID(){return this.id}setID(a){return this.id=a,this}getName(){return this.name}}class BlockIntent extends ManagerItem{constructor({name:a,block:b}){super();this.name=a,this.block=b instanceof Promise?b:Promise.resolve(b)}getName(){return this.name}getBlock(){return this.block}}class BlockManager extends AdvancedManager{constructor(a){super(a);this.activeBlocks=new Manager(),this.activeIDs=new Manager()}async init(){let a=this.getApp();for(let[,b]of this){let c=b.getName(),d=`[${this.getConfig("blockAttr",!1)}="${c}"]`,e=[...document.querySelectorAll(d)],f=[],g=new AdvancedManager(a),h=await b.getBlock();for(let i=0,j=e.length;i<j;i++){let l=e[i],k=l.id,m=new h();m.init({name:c,rootElement:l,selector:d,index:i}),m.setID(k),f[i]=k,g.set(i,m)}this.activeIDs[c]=f,this.activeBlocks.set(c,g)}}async update(){let a=this.getApp();for(let[,b]of this){let c=b.getName(),d=`[${this.getConfig("blockAttr",!1)}="${c}"]`,e=[...document.querySelectorAll(d)],f=[],g=new AdvancedManager(a),h=await b.getBlock();for(let i=0,j=e.length;i<j;i++){let l=e[i],k=l.id;if(this.activeIDs[c][i]!==k){let m=new h();m.init({name:c,rootElement:l,selector:d,index:i}),m.setID(k),m.boot(),f[i]=k,g.set(i,m)}}this.activeIDs[c]=f,this.activeBlocks.set(c,g)}}initEvents(){for(let[,d]of this.activeBlocks)d.methodCall("initEvents");let a=this.getApp(),b=a.getPages().last().getWrapper();this.update=this.update.bind(this),this.domObserver=new window.MutationObserver(this.update),this.observe(b);const c=a.getEmitter();return c.on("BEFORE_TRANSITION_IN",async()=>{b=a.getPages().last().getWrapper(),this.domObserver.disconnect(),this.refresh(),await this.init(),this.boot(),this.observe(b)}),this}observe(a){this.domObserver.observe(a,{childList:!0,attributes:!1,characterData:!1,subtree:!0})}boot(){for(let[,a]of this.activeBlocks)a.methodCall("boot");return this}refresh(){for(let[,a]of this.activeBlocks)a.methodCall("stop");return this.activeBlocks.clear(),this}stop(){return this.refresh(),this.stopEvents(),this}stopEvents(){for(let[,a]of this.activeBlocks)a.methodCall("stopEvents");return this}getActiveBlocks(){return this.activeBlocks}}class App{constructor(a={}){this.register(a)}register(a={}){this.config=a instanceof CONFIG?a:new CONFIG(a),this.transitions=new TransitionManager(this),this.services=new ServiceManager(this),this.blocks=new BlockManager(this),this.history=new HistoryManager(),this.pages=new PageManager(this),this.emitter=new EventEmitter();let b=(()=>{document.removeEventListener("DOMContentLoaded",b),window.removeEventListener("load",b),this.emitter.emit("READY ready")}).bind(this);return document.addEventListener("DOMContentLoaded",b),window.addEventListener("load",b),this}getConfig(...a){return this.config.getConfig(...a)}getEmitter(){return this.emitter}getBlocks(){return this.blocks}getServices(){return this.services}getPages(){return this.pages}getTransitions(){return this.transitions}getHistory(){return this.history}getBlock(a){return this.blocks.get(a)}getActiveBlock(a,b){return this.blocks.getActiveBlocks().get(a).get(b)}getService(a){return this.services.get(a)}getTransition(a){return this.transitions.get(a)}getState(a){return this.history.get(a)}get(a,b){switch(a.toLowerCase()){case"service":this.getService(b);break;case"transition":this.getTransition(b);break;case"state":this.getState(b);break;default:throw`Error: can't get type '${a}', it is not a recognized type. Did you spell it correctly.`}return this}async loadPage(a){return await this.pages.load(a)}async load(a,b){switch(a.toLowerCase()){case"page":return await this.loadPage(b);default:return Promise.resolve(this.get(a,b))}}addBlock(a){return this.blocks.add(a),this}addService(a){return this.services.add(a),this}addTransition(a){return this.transitions.add(a),this}addState(a){return this.history.addState(a),this}add(a,b){switch(a.toLowerCase()){case"service":this.addService(b);break;case"transition":this.addTransition(b);break;case"state":this.addState(b);break;case"block":this.addBlock(b);break;default:throw`Error: can't add type '${a}', it is not a recognized type. Did you spell it correctly.`}return this}async boot(){return await this.blocks.init(),this.services.boot(),this.services.initEvents(),this.blocks.boot(),this.blocks.initEvents(),this.transitions.initEvents(),Promise.resolve(this)}stop(){return this.services.stop(),this.blocks.stop(),this.transitions.stopEvents(),this}currentPage(){let a=this.history.last();return this.pages.get(a.getURLPathname())}on(a,b){return this.emitter.on(a,b,this),this}off(a,b){return this.emitter.off(a,b,this),this}once(a,b){return this.emitter.once(a,b,this),this}emit(a,...b){return this.emitter.emit(a,...b),this}}class PJAX extends Service{constructor(){super(...arguments);this.ignoreURLs=[],this.prefetchIgnore=!1,this.isTransitioning=!1,this.stopOnTransitioning=!1,this.stickyScroll=!0,this.forceOnError=!1,this.autoScrollOnHash=!0}transitionStart(){this.isTransitioning=!0}transitionStop(){this.isTransitioning=!1}boot(){let a=new State();this.HistoryManager.add(a),this.changeState("replace",a)}getTransitionName(a){if(!a||!a.getAttribute)return null;let b=a.getAttribute(this.getConfig("transitionAttr",!1));return typeof b==="string"?b:null}validLink(a,b,c){let d=!window.history.pushState,e=!a||!c,f=b.which>1||b.metaKey||b.ctrlKey||b.shiftKey||b.altKey,g=a.hasAttribute("target")&&a.target==="_blank",h=a.protocol!==location.protocol||a.hostname!==location.hostname,i=typeof a.getAttribute("download")==="string",j=a.hasAttribute(this.getConfig("preventSelfAttr",!1)),l=Boolean(a.closest(this.getConfig("preventAllAttr"))),k=j&&l,m=new _URL().getFullPath()===new _URL(c).getFullPath();return!(e||d||f||g||h||i||k||m)}getHref(a){return a&&a.tagName&&a.tagName.toLowerCase()==="a"&&typeof a.href==="string"?a.href:null}getLink(a){let b=a.target,c=this.getHref(b);for(;b&&!c;)b=b.parentNode,c=this.getHref(b);return!b||!this.validLink(b,a,c)?void 0:b}onClick(a){let b=this.getLink(a);if(!b)return;if(this.isTransitioning&&this.stopOnTransitioning){a.preventDefault(),a.stopPropagation();return}let c=this.getHref(b);this.EventEmitter.emit("ANCHOR_CLICK CLICK",a),this.go({href:c,trigger:b,event:a})}getDirection(a){return Math.abs(a)>1?a>0?"forward":"back":a===0?"popstate":a>0?"back":"forward"}force(a){window.location.assign(a)}go({href:a,trigger:b="HistoryManager",event:c}){if(this.isTransitioning&&this.stopOnTransitioning){this.force(a);return}let d=new _URL(a),e=this.HistoryManager.last(),f=e.getURL();if(f.equalTo(d)){this.hashAction(d.hash);return}let g;if(c&&c.state){this.EventEmitter.emit("POPSTATE",c);let{state:h}=c,{index:i,transition:j,data:l}=h,k=e.getIndex(),m=k-i;b=this.getDirection(m),g=j;if(b!=="popstate"){let{x:s,y:t}=l.scroll;window.scroll({top:t,left:s,behavior:"smooth"})}b==="back"?(this.HistoryManager.delete(k),this.EventEmitter.emit("POPSTATE_BACK",c)):b==="forward"&&(this.HistoryManager.addState({url:d,transition:j,data:l}),this.EventEmitter.emit("POPSTATE_FORWARD",c))}else{g=this.getTransitionName(b)||"default";const h=new Coords(),i=this.HistoryManager.size,j=new State({url:d,index:i,transition:g,data:{scroll:h}});if(this.stickyScroll){let{x:l,y:k}=h;window.scroll({top:k,left:l,behavior:"smooth"})}else window.scroll({top:0,left:0,behavior:"smooth"});this.HistoryManager.add(j),this.changeState("push",j),this.EventEmitter.emit("HISTORY_NEW_ITEM",c)}return c&&(c.stopPropagation(),c.preventDefault()),this.EventEmitter.emit("GO",c),this.load({oldHref:f.getPathname(),href:a,trigger:b,transitionName:g})}changeState(a,b){let c=b.getURL(),d=c.getFullPath(),e=b.toJSON(),f=[e,"",d];if(window.history)switch(a){case"push":window.history.pushState.apply(window.history,f);break;case"replace":window.history.replaceState.apply(window.history,f);break}}async load({oldHref:a,href:b,trigger:c,transitionName:d="default"}){try{let e=this.PageManager.get(a),f;this.EventEmitter.emit("PAGE_LOADING",{href:b,oldPage:e,trigger:c});try{try{f=await this.PageManager.load(b),this.transitionStart(),this.EventEmitter.emit("PAGE_LOAD_COMPLETE",{newPage:f,oldPage:e,trigger:c})}catch(g){throw`[PJAX] Page load error: ${g}`}this.EventEmitter.emit("NAVIGATION_START",{oldPage:e,newPage:f,trigger:c,transitionName:d});try{this.EventEmitter.emit("TRANSITION_START",d);let g=await this.TransitionManager.boot({name:d,oldPage:e,newPage:f,trigger:c});this.hashAction(),this.EventEmitter.emit("TRANSITION_END",{transition:g})}catch(g){throw`[PJAX] Transition error: ${g}`}this.EventEmitter.emit("NAVIGATION_END",{oldPage:e,newPage:f,trigger:c,transitionName:d})}catch(g){throw this.transitionStop(),g}this.transitionStop()}catch(e){this.forceOnError?this.force(b):console.error(e)}}hashAction(a=window.location.hash){if(this.autoScrollOnHash){let b=a.slice(1);if(b.length){let c=document.getElementById(b);if(c)if(c.scrollIntoView)c.scrollIntoView({behavior:"smooth"});else{let{left:d,top:e}=c.getBoundingClientRect();window.scroll({left:d,top:e,behavior:"smooth"})}}}}ignoredURL({pathname:a}){return this.ignoreURLs.length&&this.ignoreURLs.some(b=>typeof b==="string"?b===a:b.exec(a)!==null)}onHover(a){let b=this.getLink(a);if(!b)return;const c=new _URL(this.getHref(b)),d=c.getPathname();if(this.ignoredURL(c)||this.PageManager.has(d))return;this.EventEmitter.emit("ANCHOR_HOVER HOVER hover",a),(async()=>{try{await this.PageManager.load(c)}catch(e){console.warn("[PJAX] Prefetch error: ",e)}})()}onStateChange(a){this.go({href:window.location.href,trigger:"popstate",event:a})}bindEvents(){this.onHover=this.onHover.bind(this),this.onClick=this.onClick.bind(this),this.onStateChange=this.onStateChange.bind(this)}initEvents(){this.bindEvents(),this.prefetchIgnore!==!0&&(document.addEventListener("mouseover",this.onHover),document.addEventListener("touchstart",this.onHover)),document.addEventListener("click",this.onClick),window.addEventListener("popstate",this.onStateChange)}stopEvents(){this.prefetchIgnore!==!0&&(document.removeEventListener("mouseover",this.onHover),document.removeEventListener("touchstart",this.onHover)),document.removeEventListener("click",this.onClick),window.removeEventListener("popstate",this.onStateChange)}}class Router extends Service{constructor(a=[]){super();this.routes=new Manager();for(const b of a)this.add(b)}add({path:a,method:b}){const c=this.parse(a);return this.routes.set(c,b),this}parsePath(a){if(typeof a==="string")return new RegExp(a,"i");if(a instanceof RegExp)return a;throw"[Router] only regular expressions and strings are accepted as paths."}isPath(a){return typeof a==="string"||a instanceof RegExp}parse(a){let b=a,c={from:/(.*)/g,to:/(.*)/g};if(this.isPath(a))c={from:a,to:/(.*)/g};else if(this.isPath(b.from)&&this.isPath(b.to))c=b;else throw"[Router] path is neither a string, regular expression, or a { from, to } object.";let{from:d,to:e}=c;return{from:this.parsePath(d),to:this.parsePath(e)}}route(){let a=this.HistoryManager.last().getURLPathname(),b=window.location.pathname;this.routes.forEach((c,d)=>{let e=d.from,f=d.to;if(e.test(a)&&f.test(b)){let g=e.exec(a),h=f.exec(b);c({from:g,to:h})}})}initEvents(){this.route=this.route.bind(this),this.EventEmitter.on("READY",this.route),this.EventEmitter.on("PAGE_LOADING",this.route)}}const getElements=a=>typeof a==="string"?Array.from(document.querySelectorAll(a)):[a],getTargets=a=>Array.isArray(a)?a:typeof a=="string"||a instanceof Node?getElements(a):a instanceof NodeList||a instanceof HTMLCollection?Array.from(a):[],computeValue=(a,b)=>typeof a==="function"?a(...b):a,mapObject=(a,b)=>{let c,d,e={},f=Object.keys(a);for(let g=0,h=f.length;g<h;g++)c=f[g],d=a[c],e[c]=computeValue(d,b);return e},easings={ease:"ease",in:"ease-in",out:"ease-out","in-out":"ease-in-out","in-sine":"cubic-bezier(0.47, 0, 0.745, 0.715)","out-sine":"cubic-bezier(0.39, 0.575, 0.565, 1)","in-out-sine":"cubic-bezier(0.445, 0.05, 0.55, 0.95)","in-quad":"cubic-bezier(0.55, 0.085, 0.68, 0.53)","out-quad":"cubic-bezier(0.25, 0.46, 0.45, 0.94)","in-out-quad":"cubic-bezier(0.455, 0.03, 0.515, 0.955)","in-cubic":"cubic-bezier(0.55, 0.055, 0.675, 0.19)","out-cubic":"cubic-bezier(0.215, 0.61, 0.355, 1)","in-out-cubic":"cubic-bezier(0.645, 0.045, 0.355, 1)","in-quart":"cubic-bezier(0.895, 0.03, 0.685, 0.22)","out-quart":"cubic-bezier(0.165, 0.84, 0.44, 1)","in-out-quart":"cubic-bezier(0.77, 0, 0.175, 1)","in-quint":"cubic-bezier(0.755, 0.05, 0.855, 0.06)","out-quint":"cubic-bezier(0.23, 1, 0.32, 1)","in-out-quint":"cubic-bezier(0.86, 0, 0.07, 1)","in-expo":"cubic-bezier(0.95, 0.05, 0.795, 0.035)","out-expo":"cubic-bezier(0.19, 1, 0.22, 1)","in-out-expo":"cubic-bezier(1, 0, 0, 1)","in-circ":"cubic-bezier(0.6, 0.04, 0.98, 0.335)","out-circ":"cubic-bezier(0.075, 0.82, 0.165, 1)","in-out-circ":"cubic-bezier(0.785, 0.135, 0.15, 0.86)","in-back":"cubic-bezier(0.6, -0.28, 0.735, 0.045)","out-back":"cubic-bezier(0.175, 0.885, 0.32, 1.275)","in-out-back":"cubic-bezier(0.68, -0.55, 0.265, 1.55)"},getEase=a=>/^(ease|in|out)/.test(a)?easings[a]:a,DefaultAnimationOptions={keyframes:[],loop:1,delay:0,speed:1,endDelay:0,easing:"ease",autoplay:!0,duration:1e3,onfinish(){},fillMode:"auto",direction:"normal"};class Animate{constructor(a={}){this.options={},this.targets=[],this.properties={},this.animations=new Map(),this.duration=0,this.emitter=new EventEmitter();let{options:b,...c}=a;this.options=Object.assign({},DefaultAnimationOptions,b,c);let{loop:d,delay:e,speed:f,easing:g,endDelay:h,duration:i,direction:j,fillMode:l,onfinish:k,target:m,keyframes:s,autoplay:t,...x}=this.options;this.mainElement=document.createElement("span"),this.targets=getTargets(m),this.properties=x;let r;for(let n=0,q=this.targets.length;n<q;n++){let p=this.targets[n],o={easing:getEase(g),iterations:d===!0?Infinity:d,direction:j,endDelay:h,duration:i,delay:e,fill:l},u=computeValue(s,[n,q,p]);r=u.length?u:this.properties,o=mapObject(o,[n,q,p]),u.length>0||(r=mapObject(r,[n,q,p]));let v=o.delay+o.duration*o.iterations+o.endDelay;this.duration<v&&(this.duration=v);let w=p.animate(r,o);w.onfinish=()=>{k(p,n,q)},this.animations.set(p,w)}this.mainAnimation=this.mainElement.animate([{opacity:"0"},{opacity:"1"}],{duration:this.duration,easing:"linear"}),this.setSpeed(f),t?this.play():this.pause(),this.promise=this.newPromise(),this.mainAnimation.onfinish=()=>{this.finish(this.options),window.cancelAnimationFrame(this.animationFrame)}}newPromise(){return new Promise((a,b)=>{try{this.finish=c=>(this.emit("finish",c),a(c))}catch(c){b(c)}})}then(a,b){return this.promise.then(a,b)}catch(a){return this.promise.catch(a)}finally(a){return this.promise.finally(a)}loop(){this.animationFrame=window.requestAnimationFrame(this.loop.bind(this)),this.emit("tick change",this.getCurrentTime())}on(a,b,c){return this.emitter.on(a,b,c),this}off(a,b,c){return this.emitter.off(a,b,c),this}emit(a,...b){return this.emitter.emit(a,...b),this}getAnimation(a){return this.animations.get(a)}play(){return this.mainAnimation.playState!=="finished"&&(this.mainAnimation.play(),this.animationFrame=requestAnimationFrame(this.loop.bind(this)),this.animations.forEach(a=>{a.playState!=="finished"&&a.play()}),this.emit("play")),this}pause(){return this.mainAnimation.playState!=="finished"&&(this.mainAnimation.pause(),window.cancelAnimationFrame(this.animationFrame),this.animations.forEach(a=>{a.playState!=="finished"&&a.pause()}),this.emit("pause")),this}getDuration(){return this.duration}getCurrentTime(){return this.mainAnimation.currentTime}setCurrentTime(a){return this.mainAnimation.currentTime=a,this.animations.forEach(b=>{b.currentTime=a}),this}getProgress(){return this.getCurrentTime()/this.duration}setProgress(a){return this.mainAnimation.currentTime=a*this.duration,this.animations.forEach(b=>{b.currentTime=a*this.duration}),this}getSpeed(){return this.mainAnimation.playbackRate}setSpeed(a=1){return this.mainAnimation.playbackRate=a,this.animations.forEach(b=>{b.playbackRate=a}),this}reset(){this.setCurrentTime(0),this.promise=this.newPromise(),this.options.autoplay?this.play():this.pause()}getPlayState(){return this.mainAnimation.playState}getOptions(){return this.options}toJSON(){return this.getOptions()}}const animate=(a={})=>new Animate(a);class InViewBlock extends Block{constructor(){super(...arguments);this.inView=!1}boot(){this.observerOptions={root:null,rootMargin:"0px",thresholds:Array.from(Array(20),(a,b)=>(b+1)/20)},this.observer=new IntersectionObserver(a=>{this.onIntersectionCallback(a)},this.observerOptions),this.imgs=[],this.direction="right",this.xPercent=30,this.rootElement.hasAttribute("data-direction")&&(this.direction=this.rootElement.getAttribute("data-direction")),this.direction==="left"&&(this.xPercent=-this.xPercent),this.imgs=[...this.rootElement.querySelectorAll("img")],this.observe()}observe(){this.observer.observe(this.rootElement)}unobserve(){this.observer.unobserve(this.rootElement)}onScreen(){animate({target:this.rootElement,transform:[`translateX(${this.xPercent}%)`,"translateX(0%)"],opacity:[0,1],duration:1500,delay:.15,easing:"out-quint",onfinish(a){a.style.transform="translateX(0%)",a.style.opacity="1"}})}offScreen(){this.rootElement.style.transform=`translateX(${this.xPercent}%)`,this.rootElement.style.opacity="0"}onIntersectionCallback(a){for(let b of a)b.intersectionRatio>0?this.onScreen():this.offScreen()}stopEvents(){this.unobserve()}}class IntroBlock extends Block{initEvents(){this.prepareToShow=this.prepareToShow.bind(this),this.show=this.show.bind(this),this.EventEmitter.on("BEFORE_SPLASHSCREEN_HIDE BEFORE_TRANSITION_IN",this.prepareToShow),this.EventEmitter.on("START_SPLASHSCREEN_HIDE NAVIGATION_END",this.show)}stopEvents(){this.EventEmitter.off("BEFORE_SPLASHSCREEN_HIDE BEFORE_TRANSITION_IN",this.prepareToShow),this.EventEmitter.off("START_SPLASHSCREEN_HIDE NAVIGATION_END",this.show)}stop(){super.stop(),this.rootElement.style.transform="translateY(0px)",this.rootElement.style.opacity="1"}prepareToShow(){this.rootElement.style.transform="translateY(200px)",this.rootElement.style.opacity="0"}async show(){return await animate({target:this.rootElement,keyframes:[{transform:"translateY(200px)",opacity:0},{transform:"translateY(0px)",opacity:1}],delay:200*(this.index+1),onfinish(a){a.style.transform="translateY(0px)",a.style.opacity="1"},easing:"out-cubic",duration:500})}}const getTheme=()=>{const a=window.localStorage.getItem("theme");return typeof a==="string"?a:null},setTheme=a=>{typeof a==="string"&&window.localStorage.setItem("theme",a)},mediaTheme=()=>{const a=window.matchMedia("(prefers-color-scheme: dark)"),b=typeof a.matches==="boolean";return b?a.matches?"dark":"light":null};class Splashscreen extends Service{constructor(){super(...arguments);this.minimalDuration=1e3}boot(){this.rootElement=document.getElementById("splashscreen"),this.rootElement&&(this.innerEl=this.rootElement.querySelector(".splashscreen-inner"),this.bgEl=this.rootElement.querySelector(".splashscreen-bg")),this.rootElement.style.visibility="visible",this.rootElement.style.pointerEvents="auto"}initEvents(){this.rootElement&&this.hide()}async hide(){await new Promise(a=>{window.setTimeout(()=>{this.EventEmitter.emit("BEFORE_SPLASHSCREEN_HIDE"),a()},this.minimalDuration)}),await new Promise(async a=>{animate({target:this.innerEl,opacity:[1,0],autoplay:!0,duration:500,onfinish(b){b.style.opacity="0"}}),this.EventEmitter.emit("START_SPLASHSCREEN_HIDE"),await this.show(),a()})}async show(){await animate({target:this.rootElement,transform:["translateY(0%)","translateY(100%)"],duration:1200,easing:"in-out-cubic"}),this.rootElement.style.transform="translateY(100%)",this.rootElement.style.visibility="hidden",this.rootElement.style.pointerEvents="none"}}class Fade extends Transition{constructor(){super(...arguments);this.name="default",this.duration=500}out({from:a}){let{duration:b}=this,c=a.getWrapper();return window.scroll({top:0,behavior:"smooth"}),new Promise(async d=>{await animate({target:c,opacity:[1,0],duration:b,onfinish(e){e.style.opacity="0"}}),window.scrollTo(0,0),d()})}in({to:a}){let{duration:b}=this,c=a.getWrapper();return c.style.transform="translateX(0%)",animate({target:c,opacity:[0,1],duration:b,onfinish(d){d.style.opacity="1"}})}}class Slide extends Transition{constructor(){super(...arguments);this.name="slide",this.duration=500,this.direction="right"}out({from:a}){let{duration:b,direction:c}=this,d=a.getWrapper();return window.scroll({top:0,behavior:"smooth"}),animate({target:d,keyframes:[{transform:"translateX(0%)",opacity:1},{transform:`translateX(${c==="left"?"-":""}25%)`,opacity:0}],duration:b,easing:"in-quint",onfinish:e=>{e.style.opacity="0",e.style.transform=`translateX(${c==="left"?"-":""}25%)`}})}in({to:a}){let{duration:b}=this,c=a.getWrapper();return animate({target:c,keyframes:[{transform:`translateX(${this.direction==="right"?"-":""}25%)`,opacity:0},{transform:"translateX(0%)",opacity:1}],duration:b,easing:"out-quint",onfinish(d){d.style.opacity="1",d.style.transform="translateX(0%)"}})}}class SlideLeft extends Slide{constructor(){super(...arguments);this.name="slide-left",this.duration=500,this.direction="left"}}class SlideRight extends Slide{constructor(){super(...arguments);this.name="slide-right",this.duration=500,this.direction="right"}}class BigTransition extends Transition{constructor(){super(...arguments);this.name="big",this.delay=200,this.durationPerAnimation=700}boot(){this.mainElement=document.getElementById("big-transition"),this.spinnerElement=this.mainElement.querySelector(".spinner"),this.horizontalElements=[...this.mainElement.querySelector("#big-transition-horizontal").querySelectorAll("div")],this.maxLength=this.horizontalElements.length}out({from:a}){let{durationPerAnimation:b,delay:c}=this,d=a.getWrapper();return window.scroll({top:0,behavior:"smooth"}),new Promise(async e=>{animate({target:d,opacity:[1,0],duration:b,onfinish(h){h.style.opacity="0"}}),this.mainElement.style.opacity="1",this.mainElement.style.visibility="visible",await animate({target:this.horizontalElements,keyframes:[{transform:"scaleX(0)"},{transform:"scaleX(1)"}],delay(h){return c*(h+1)},onfinish(h){h.style.transform="scaleX(1)"},easing:"out-cubic",duration:500});let f=500;this.spinnerElement.style.visibility="visible";let g=await animate({target:this.spinnerElement,opacity:[0,1],duration:f,onfinish(h){h.style.opacity="1"}});await animate({options:g,opacity:[1,0],onfinish(h){h.style.opacity="0"},delay:1500}),this.spinnerElement.style.visibility="hidden",e()})}in({to:a}){let{durationPerAnimation:b,delay:c}=this,d=a.getWrapper();return d.style.transform="translateX(0%)",new Promise(async e=>{animate({target:d,opacity:[0,1],onfinish(f){f.style.opacity="1"},duration:b}),await animate({target:this.horizontalElements,keyframes:[{transform:"scaleX(1)"},{transform:"scaleX(0)"}],delay(f){return c*(f+1)},onfinish(f){f.style.transform="scaleX(0)"},easing:"out-cubic",duration:500}),this.mainElement.style.opacity="0",this.mainElement.style.visibility="hidden",e()})}}const html=document.querySelector("html");try{let a=getTheme();a===null&&(a=mediaTheme()),a&&html.setAttribute("theme",a)}catch(a){console.warn("Theming isn't available on this browser.")}let themeSet=a=>{html.setAttribute("theme",a),setTheme(a)};window.matchMedia("(prefers-color-scheme: dark)").addListener(a=>{themeSet(a.matches?"dark":"light")});const app=new App();let splashscreen,router;app.add("service",new PJAX()).add("service",splashscreen=new Splashscreen()).add("service",router=new Router()).add("transition",new Fade()).add("transition",new BigTransition()).add("transition",new Slide()).add("transition",new SlideLeft()).add("transition",new SlideRight()).add("block",new BlockIntent({name:"IntroBlock",block:IntroBlock})).add("block",new BlockIntent({name:"InViewBlock",block:InViewBlock})),(async()=>{try{await app.boot();let a=document.querySelectorAll(".navbar .nav-link");for(let b of a){let c=b;router.add({path:c.getAttribute("data-path")||c.pathname,method(){let d=c.classList.contains("active");d||c.classList.add("active");for(let e of a)e!==c&&e.classList.remove("active")}})}}catch(a){splashscreen.show(),console.warn("[App] Boot failed,",a)}})();
//# sourceMappingURL=app.js.map
