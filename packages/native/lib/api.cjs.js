var de=Object.create;var F=Object.defineProperty;var be=Object.getOwnPropertyDescriptor;var Te=Object.getOwnPropertyNames;var Ee=Object.getPrototypeOf,ve=Object.prototype.hasOwnProperty;var Q=i=>F(i,"__esModule",{value:!0});var Ie=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),Ae=(i,e)=>{Q(i);for(var t in e)F(i,t,{get:e[t],enumerable:!0})},xe=(i,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Te(e))!ve.call(i,r)&&r!=="default"&&F(i,r,{get:()=>e[r],enumerable:!(t=be(e,r))||t.enumerable});return i},Z=i=>xe(Q(F(i!=null?de(Ee(i)):{},"default",i&&i.__esModule&&"default"in i?{get:()=>i.default,enumerable:!0}:{value:i,enumerable:!0})),i);var B=Ie(y=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0});y.pathToRegexp=y.tokensToRegexp=y.regexpToFunction=y.match=y.tokensToFunction=y.compile=y.parse=void 0;function we(i){for(var e=[],t=0;t<i.length;){var r=i[t];if(r==="*"||r==="+"||r==="?"){e.push({type:"MODIFIER",index:t,value:i[t++]});continue}if(r==="\\"){e.push({type:"ESCAPED_CHAR",index:t++,value:i[t++]});continue}if(r==="{"){e.push({type:"OPEN",index:t,value:i[t++]});continue}if(r==="}"){e.push({type:"CLOSE",index:t,value:i[t++]});continue}if(r===":"){for(var n="",s=t+1;s<i.length;){var a=i.charCodeAt(s);if(a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122||a===95){n+=i[s++];continue}break}if(!n)throw new TypeError("Missing parameter name at "+t);e.push({type:"NAME",index:t,value:n}),t=s;continue}if(r==="("){var c=1,o="",s=t+1;if(i[s]==="?")throw new TypeError('Pattern cannot start with "?" at '+s);for(;s<i.length;){if(i[s]==="\\"){o+=i[s++]+i[s++];continue}if(i[s]===")"){if(c--,c===0){s++;break}}else if(i[s]==="("&&(c++,i[s+1]!=="?"))throw new TypeError("Capturing groups are not allowed at "+s);o+=i[s++]}if(c)throw new TypeError("Unbalanced pattern at "+t);if(!o)throw new TypeError("Missing pattern at "+t);e.push({type:"PATTERN",index:t,value:o}),t=s;continue}e.push({type:"CHAR",index:t,value:i[t++]})}return e.push({type:"END",index:t,value:""}),e}function z(i,e){e===void 0&&(e={});for(var t=we(i),r=e.prefixes,n=r===void 0?"./":r,s="[^"+M(e.delimiter||"/#?")+"]+?",a=[],c=0,o=0,l="",p=function(A){if(o<t.length&&t[o].type===A)return t[o++].value},u=function(A){var _=p(A);if(_!==void 0)return _;var J=t[o],fe=J.type,ye=J.index;throw new TypeError("Unexpected "+fe+" at "+ye+", expected "+A)},m=function(){for(var A="",_;_=p("CHAR")||p("ESCAPED_CHAR");)A+=_;return A};o<t.length;){var g=p("CHAR"),T=p("NAME"),I=p("PATTERN");if(T||I){var h=g||"";n.indexOf(h)===-1&&(l+=h,h=""),l&&(a.push(l),l=""),a.push({name:T||c++,prefix:h,suffix:"",pattern:I||s,modifier:p("MODIFIER")||""});continue}var E=g||p("ESCAPED_CHAR");if(E){l+=E;continue}l&&(a.push(l),l="");var P=p("OPEN");if(P){var h=m(),k=p("NAME")||"",w=p("PATTERN")||"",j=m();u("CLOSE"),a.push({name:k||(w?c++:""),pattern:k&&!w?s:w,prefix:h,suffix:j,modifier:p("MODIFIER")||""});continue}u("END")}return a}y.parse=z;function Le(i,e){return ie(z(i,e),e)}y.compile=Le;function ie(i,e){e===void 0&&(e={});var t=$(e),r=e.encode,n=r===void 0?function(o){return o}:r,s=e.validate,a=s===void 0?!0:s,c=i.map(function(o){if(typeof o=="object")return new RegExp("^(?:"+o.pattern+")$",t)});return function(o){for(var l="",p=0;p<i.length;p++){var u=i[p];if(typeof u=="string"){l+=u;continue}var m=o?o[u.name]:void 0,g=u.modifier==="?"||u.modifier==="*",T=u.modifier==="*"||u.modifier==="+";if(Array.isArray(m)){if(!T)throw new TypeError('Expected "'+u.name+'" to not repeat, but got an array');if(m.length===0){if(g)continue;throw new TypeError('Expected "'+u.name+'" to not be empty')}for(var I=0;I<m.length;I++){var h=n(m[I],u);if(a&&!c[p].test(h))throw new TypeError('Expected all "'+u.name+'" to match "'+u.pattern+'", but got "'+h+'"');l+=u.prefix+h+u.suffix}continue}if(typeof m=="string"||typeof m=="number"){var h=n(String(m),u);if(a&&!c[p].test(h))throw new TypeError('Expected "'+u.name+'" to match "'+u.pattern+'", but got "'+h+'"');l+=u.prefix+h+u.suffix;continue}if(!g){var E=T?"an array":"a string";throw new TypeError('Expected "'+u.name+'" to be '+E)}}return l}}y.tokensToFunction=ie;function Pe(i,e){var t=[],r=q(i,t,e);return ne(r,t,e)}y.match=Pe;function ne(i,e,t){t===void 0&&(t={});var r=t.decode,n=r===void 0?function(s){return s}:r;return function(s){var a=i.exec(s);if(!a)return!1;for(var c=a[0],o=a.index,l=Object.create(null),p=function(m){if(a[m]===void 0)return"continue";var g=e[m-1];g.modifier==="*"||g.modifier==="+"?l[g.name]=a[m].split(g.prefix+g.suffix).map(function(T){return n(T,g)}):l[g.name]=n(a[m],g)},u=1;u<a.length;u++)p(u);return{path:c,index:o,params:l}}}y.regexpToFunction=ne;function M(i){return i.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function $(i){return i&&i.sensitive?"":"i"}function Se(i,e){if(!e)return i;for(var t=/\((?:\?<(.*?)>)?(?!\?)/g,r=0,n=t.exec(i.source);n;)e.push({name:n[1]||r++,prefix:"",suffix:"",modifier:"",pattern:""}),n=t.exec(i.source);return i}function Ce(i,e,t){var r=i.map(function(n){return q(n,e,t).source});return new RegExp("(?:"+r.join("|")+")",$(t))}function Me(i,e,t){return se(z(i,t),e,t)}function se(i,e,t){t===void 0&&(t={});for(var r=t.strict,n=r===void 0?!1:r,s=t.start,a=s===void 0?!0:s,c=t.end,o=c===void 0?!0:c,l=t.encode,p=l===void 0?function(A){return A}:l,u="["+M(t.endsWith||"")+"]|$",m="["+M(t.delimiter||"/#?")+"]",g=a?"^":"",T=0,I=i;T<I.length;T++){var h=I[T];if(typeof h=="string")g+=M(p(h));else{var E=M(p(h.prefix)),P=M(p(h.suffix));if(h.pattern)if(e&&e.push(h),E||P)if(h.modifier==="+"||h.modifier==="*"){var k=h.modifier==="*"?"?":"";g+="(?:"+E+"((?:"+h.pattern+")(?:"+P+E+"(?:"+h.pattern+"))*)"+P+")"+k}else g+="(?:"+E+"("+h.pattern+")"+P+")"+h.modifier;else g+="("+h.pattern+")"+h.modifier;else g+="(?:"+E+P+")"+h.modifier}}if(o)n||(g+=m+"?"),g+=t.endsWith?"(?="+u+")":"$";else{var w=i[i.length-1],j=typeof w=="string"?m.indexOf(w[w.length-1])>-1:w===void 0;n||(g+="(?:"+m+"(?="+u+"))?"),j||(g+="(?="+m+"|"+u+")")}return new RegExp(g,$(t))}y.tokensToRegexp=se;function q(i,e,t){return i instanceof RegExp?Se(i,e):Array.isArray(i)?Ce(i,e,t):Me(i,e,t)}y.pathToRegexp=q});Ae(exports,{AdvancedManager:()=>C,App:()=>ue,CONFIG_DEFAULTS:()=>ee,HistoryManager:()=>te,Manager:()=>d,ManagerItem:()=>S,PARSER:()=>oe,PJAX:()=>he,Page:()=>K,PageManager:()=>le,Router:()=>me,Service:()=>b,ServiceManager:()=>D,TRANSITION_REPLACE:()=>Y,TransitionManager:()=>pe,changeState:()=>re,clean:()=>G,equal:()=>N,getHash:()=>Re,getHashedPath:()=>v,hashAction:()=>W,ignoreURLs:()=>O,methodCall:()=>L,newConfig:()=>V,newCoords:()=>R,newState:()=>H,newURL:()=>f,toAttr:()=>x});var ee={wrapperAttr:"wrapper",headers:[],preventSelfAttr:'prevent="self"',preventAllAttr:'prevent="all"',transitionAttr:"transition",timeout:2e3,maxPages:5,resizeDelay:100,onTransitionPreventClick:!0,cacheIgnore:!1,prefetchIgnore:!1,preventURLs:[],stickyScroll:!1,forceOnError:!0,ignoreHashAction:!1,transitions:[]},V=i=>Object.assign({...ee},i),x=(i,e,t=!0)=>{let{prefix:r}=i,n=i[e],s=`data${r?"-"+r:""}-${n}`;return t?`[${s}]`:s};var d=class{constructor(e){this.map=new Map(e)}getMap(){return this.map}get(e){return this.map.get(e)}keys(){return Array.from(this.map.keys())}values(){return Array.from(this.map.values())}set(e,t){return this.map.set(e,t),this}add(e){let r=this.size;return this.set(r,e),this}get size(){return this.map.size}get length(){return this.map.size}last(e=1){let t=this.keys()[this.size-e];return this.get(t)}delete(e){return this.map.delete(e)}remove(e){return this.map.delete(e),this}clear(){return this.map.clear(),this}has(e){return this.map.has(e)}entries(){return this.map.entries()}forEach(e,t){return this.map.forEach(e,t),this}[Symbol.iterator](){return this.entries()}},L=(i,e,...t)=>{i.forEach(r=>{r[e](...t)})};var S=class{constructor(){}install(){}register(e,t){return this.manager=e,this.app=e.app,this.config=e.config,this.emitter=e.emitter,this.key=t,this.install(),this}uninstall(){}unregister(){this.uninstall(),this.manager.remove(this.key),this.key=null,this.manager=null,this.app=null,this.config=null,this.emitter=null}},C=class extends d{constructor(e){super();this.app=e,this.config=e.config,this.emitter=e.emitter}set(e,t){return super.set(e,t),t.register(this,e),this}};var f=(i=window.location.href)=>i instanceof URL?i:new URL(i,window.location.origin),v=i=>{let e=f(i);return`${e.pathname}${e.hash}`},Re=i=>f(i).hash.slice(1),G=i=>f(i).toString().replace(/(\/#.*|\/|#.*)$/,""),N=(i,e)=>G(i)===G(e);var b=class extends S{init(){}boot(){this.initEvents()}initEvents(){}stopEvents(){}stop(){this.stopEvents(),this.unregister()}},D=class extends C{constructor(e){super(e)}init(){return L(this,"init"),this}boot(){return L(this,"boot"),this}stop(){return L(this,"stop"),this}};var R=(i=window.scrollX,e=window.scrollY)=>({x:i,y:e}),H=(i={url:v(f()),index:0,transition:"default",data:{scroll:R(),trigger:"HistoryManager"}})=>i,te=class extends b{constructor(){super(...arguments);this.pointer=-1}init(){this.states=[];let e=H();this.add(e,"replace")}get(e){return this.states[e]}add(e,t="push"){let r=H(e),n=this.length;this.states.push({...r}),this.pointer=n;let s={index:this.pointer,states:[...this.states]};return re(t,r,s),this}remove(e){return e?this.states.splice(e,1):this.states.pop(),this.pointer--,this}replace(e){return this.states=e,this}set(e,t){return this.states[e]=t}get current(){return this.get(this.pointer)}get last(){return this.get(this.length-1)}get previous(){return this.pointer<1?null:this.get(this.pointer-1)}get length(){return this.states.length}},re=(i,e,t)=>{let r=v(e.url),n=[t,"",r];if(window.history)switch(i){case"push":window.history.pushState.apply(window.history,n);break;case"replace":window.history.replaceState.apply(window.history,n);break}};var ae=Z(B()),oe=new DOMParser,K=class extends S{constructor(e=f(),t=document){super();this.url=f(e),typeof t=="string"?this.data=t:this.dom=t||document}async build(){if(this.dom instanceof Node||(this.dom=oe.parseFromString(this.data,"text/html")),!(this.body instanceof Node)){let{title:e,head:t,body:r}=this.dom;this.title=e,this.head=t,this.body=r,this.wrapper=this.body.querySelector(this.wrapperAttr)}}install(){this.wrapperAttr=x(this.config,"wrapperAttr")}uninstall(){this.url=null,this.title=null,this.head=null,this.body=null,this.dom=null,this.wrapper=null,this.data=null,this.wrapperAttr=null}},le=class extends b{constructor(){super();this.loading=new d}install(){this.pages=new C(this.app),this.cacheIgnore=this.config.cacheIgnore;let e=f().pathname;this.set(e,new K),e=null}get(e){return this.pages.get(e)}add(e){return this.pages.add(e),this}set(e,t){return this.pages.set(e,t),this}remove(e){return this.pages.remove(e),this}has(e){return this.pages.has(e)}clear(){return this.pages.clear(),this}get size(){return this.pages.size}keys(){return this.pages.keys()}async load(e=f()){let t=f(e),r=t.pathname,n,s;if(this.has(r)&&!O(r,this.cacheIgnore))return n=this.get(r),Promise.resolve(n);this.loading.has(r)?s=this.loading.get(r):(s=this.request(r),this.loading.set(r,s));let a=await s;if(this.loading.remove(r),n=new K(t,a),this.set(r,n),this.size>this.config.maxPages){let c=f(),o=this.keys(),l=N(c,o[0])?o[1]:o[0],p=this.get(l);p.unregister(),p=null,o=null,c=null,l=null}return n}async request(e){let t=new Headers(this.config.headers),r=window.setTimeout(()=>{window.clearTimeout(r);let n=new Error("Request Timed Out!");throw this.emitter.emit("TIMEOUT_ERROR",n,e),n},this.config.timeout);try{let n=await fetch(e,{mode:"same-origin",method:"GET",headers:t,cache:"default",credentials:"same-origin"});if(window.clearTimeout(r),n.status>=200&&n.status<300)return await n.text();let s=new Error(n.statusText||""+n.status);throw this.emitter.emit("REQUEST_ERROR",s,e),s}catch(n){throw window.clearTimeout(r),n}}},O=(i,e)=>{if(typeof e=="boolean")return e;let t=[];return!e.every(r=>(0,ae.pathToRegexp)(r,t,{start:!1,end:!1}).exec(i)==null)};var W=(i,e=window.location.hash)=>{try{let t=e[0]=="#"?e:f(e).hash;if(t.length>1){let r=document.getElementById(t.slice(1));if(r){let{left:n,top:s}=r.getBoundingClientRect(),a=window.scrollX,c=window.scrollY,o=n+a,l=s+c;return R(o,l)}}}catch(t){console.warn("[hashAction] error",t)}return i??R(0,0)},Y={name:"replace"},pe=class extends b{constructor(e){super();this._arg=e}install(){super.install();let e=this._arg&&this._arg.length?this._arg:this.config.transitions;this.transitions=new d([["default",Y],["replace",Y]].concat(e))}get(e){return this.transitions.get(e)}set(e,t){return this.transitions.set(e,t),this}add(e){return this.transitions.add(e),this}has(e){return this.transitions.has(e)}async start(e,t){let r=this.transitions.get(e),{oldPage:n,newPage:s,ignoreHashAction:a,trigger:c}=t;if(this.emitter.emit("TRANSITION_START",{transitionName:e,...t}),!("wrapper"in n)||!("wrapper"in s))throw`[TransitionManager] either oldPage or newPage aren't instances of the Page Class.
 ${{newPage:s,oldPage:n}}`;document.title=""+s.title;let o=n.wrapper,l=s.wrapper;if(!(o instanceof Node)||!(l instanceof Node))throw`[TransitionManager] the wrapper from the ${l instanceof Node?"current":"next"} page cannot be found. The wrapper must be an element that has the attribute ${x(this.config,"wrapperAttr")}.`;return r.init&&r?.init(t),this.emitter.emit("BEFORE_TRANSITION_OUT",t),r.out&&await new Promise(p=>{r.out.call(r,{...t,from:n,done:p})?.then(p)}),this.emitter.emit("AFTER_TRANSITION_OUT",t),await new Promise(p=>{o.insertAdjacentElement("beforebegin",l),this.emitter.emit("CONTENT_INSERT",t),p()}),await new Promise(p=>{o.remove(),o=null,l=null,this.emitter.emit("CONTENT_REPLACED",t),!a&&!/back|popstate|forward/.test(c)&&(t.scroll=W(t.scroll)),p()}),this.emitter.emit("BEFORE_TRANSITION_IN",t),r.in&&await new Promise(p=>{r.in.call(r,{...t,from:n,to:s,done:p})?.then(p)}),this.emitter.emit("AFTER_TRANSITION_IN",t),r.manualScroll||(!a&&!/back|popstate|forward/.test(c)&&(t.scroll=W(t.scroll)),window.scroll(t.scroll.x,t.scroll.y)),this.emitter.emit("TRANSITION_END",{transitionName:e,...t}),t}};var ce=({callback:i=()=>{},scope:e=null,name:t="event"})=>({callback:i,scope:e,name:t}),U=class extends d{constructor(e="event"){super();this.name=e}},X=class extends d{constructor(){super()}getEvent(e){let t=this.get(e);return t instanceof U?t:(this.set(e,new U(e)),this.get(e))}newListener(e,t,r){let n=this.getEvent(e);return n.add(ce({name:e,callback:t,scope:r})),n}on(e,t,r){if(typeof e=="undefined"||e==null)return this;typeof e=="string"&&(e=e.trim().split(/\s/g));let n,s,a=typeof e=="object"&&!Array.isArray(e),c=a?t:r;return a||(s=t),Object.keys(e).forEach(o=>{n=a?o:e[o],a&&(s=e[o]),this.newListener(n,s,c)},this),this}removeListener(e,t,r){let n=this.get(e);if(n instanceof U&&t){let s=ce({name:e,callback:t,scope:r});n.forEach((a,c)=>{if(a.callback===s.callback&&a.scope===s.scope)return n.remove(c)})}return n}off(e,t,r){if(typeof e=="undefined"||e==null)return this;typeof e=="string"&&(e=e.trim().split(/\s/g));let n,s,a=typeof e=="object"&&!Array.isArray(e),c=a?t:r;return a||(s=t),Object.keys(e).forEach(o=>{n=a?o:e[o],a&&(s=e[o]),typeof s=="function"?this.removeListener(n,s,c):this.remove(n)},this),this}once(e,t,r){if(typeof e=="undefined"||e==null)return this;typeof e=="string"&&(e=e.trim().split(/\s/g));let n=typeof e=="object"&&!Array.isArray(e);return Object.keys(e).forEach(s=>{let a=n?s:e[s],c=n?e[s]:t,o=n?t:r,l=(...p)=>{c.apply(o,p),this.removeListener(a,l,o)};this.newListener(a,l,o)},this),this}emit(e,...t){return typeof e=="undefined"||e==null?this:(typeof e=="string"&&(e=e.trim().split(/\s/g)),e.forEach(r=>{let n=this.get(r);n instanceof U&&n.forEach(s=>{let{callback:a,scope:c}=s;a.apply(c,t)})},this),this)}clear(){return L(this,"clear"),super.clear(),this}};var ue=class{constructor(e={}){this.canResize=!0;this.canScroll=!0;this._resize=this._resize.bind(this),this._scroll=this._scroll.bind(this),this._ready=this._ready.bind(this),this.register(e)}register(e={}){return this.config=V(e),this.emitter=new X,this.services=new D(this),this}_ready(){document.removeEventListener("DOMContentLoaded",this._ready),window.removeEventListener("load",this._ready),this.emitter.emit("READY ready")}_resize(){if(this.canResize){let e,t;this.canResize=!1,t=window.requestAnimationFrame(()=>{this.emitter.emit("RESIZE resize"),e=window.setTimeout(()=>{this.canResize=!0,e=window.clearTimeout(e),t=window.cancelAnimationFrame(t)},this.config.resizeDelay)})}}_scroll(){if(this.canScroll){let e;this.canScroll=!1,e=requestAnimationFrame(()=>{this.emitter.emit("SCROLL scroll"),this.canScroll=!0,e=window.cancelAnimationFrame(e)})}}get(e){return this.services.get(e)}set(e,t){return this.services.set(e,t),this}add(e){return this.services.add(e),this}boot(){return document.addEventListener("DOMContentLoaded",this._ready),window.addEventListener("load",this._ready),window.addEventListener("resize",this._resize,{passive:!0}),window.addEventListener("scroll",this._scroll,{passive:!0}),this.services.init(),this.services.boot(),this}stop(){return window.removeEventListener("resize",this._resize),window.removeEventListener("scroll",this._scroll),this.services.stop(),this.emitter.clear(),this}on(e,t){return this.emitter.on(e,t,this),this}off(e,t){return this.emitter.off(e,t,this),this}emit(e,...t){return this.emitter.emit(e,...t),this}};var he=class extends b{install(){super.install(),this.preventURLs=this.config.preventURLs,this.prefetchIgnore=this.config.prefetchIgnore,this.onTransitionPreventClick=this.config.onTransitionPreventClick,this.stickyScroll=this.config.stickyScroll,this.forceOnError=this.config.forceOnError,this.ignoreHashAction=this.config.ignoreHashAction}transitionStart(){this.isTransitioning=!0}transitionStop(){this.isTransitioning=!1}init(){this.onHover=this.onHover.bind(this),this.onClick=this.onClick.bind(this),this.onStateChange=this.onStateChange.bind(this)}boot(){super.boot()}getTransitionName(e){if(!e||!e.getAttribute)return null;let t=e.getAttribute(x(this.config,"transitionAttr",!1));return typeof t=="string"?t:null}validLink(e,t,r){let n=!window.history.pushState,s=!e||!r,a=t.metaKey||t.ctrlKey||t.shiftKey||t.altKey,c=e.hasAttribute("target")&&e.target==="_blank",o=e.protocol!==location.protocol||e.hostname!==location.hostname,l=typeof e.getAttribute("download")=="string",p=e.matches(x(this.config,"preventSelfAttr")),u=Boolean(e.closest(x(this.config,"preventAllAttr"))),m=O(f(r).pathname,this.preventURLs),g=v(f())===v(f(r));return!(s||n||a||c||o||l||p||u||m||g)}getHref(e){return e&&e.tagName&&e.tagName.toLowerCase()==="a"&&typeof e.href=="string"?e.href:null}getLink(e){let t=e.target,r=this.getHref(t);for(;t&&!r;)t=t.parentNode,r=this.getHref(t);if(!(!t||!this.validLink(t,e,r)))return t}onClick(e){let t=this.getLink(e);if(!t)return;if(this.isTransitioning&&this.onTransitionPreventClick){e.preventDefault(),e.stopPropagation();return}let r=this.getHref(t);this.emitter.emit("ANCHOR_CLICK CLICK",e),this.go({href:r,trigger:t,event:e})}getDirection(e){return Math.abs(e)>1?e>0?"forward":"back":e===0?"popstate":e>0?"back":"forward"}force(e){window.location.assign(e)}go({href:e,trigger:t="HistoryManager",event:r}){if(this.isTransitioning&&!this.onTransitionPreventClick||!(this.manager.has("TransitionManager")&&this.manager.has("HistoryManager")&&this.manager.has("PageManager"))){this.force(e);return}let n=this.manager.get("HistoryManager"),s=R(0,0),a=n.current,c=a.url;if(N(c,e))return;let o;if(r&&r.state){this.emitter.emit("POPSTATE",r);let{state:l}=r,{index:p}=l,m=a.index-p;n.replace(l.states),n.pointer=p;let g=n.get(p);o=g.transition,s=g.data.scroll,t=this.getDirection(m),this.emitter.emit(t==="back"?"POPSTATE_BACK":"POPSTATE_FORWARD",r)}else{o=this.getTransitionName(t),s=R();let l=H({url:e,transition:o,data:{scroll:s}});!this.stickyScroll&&(s=R(0,0)),n.add(l),this.emitter.emit("HISTORY_NEW_ITEM",r)}return r&&(r.stopPropagation(),r.preventDefault()),this.emitter.emit("GO",r),this.load({oldHref:c,href:e,trigger:t,transitionName:o,scroll:s})}async load({oldHref:e,href:t,trigger:r,transitionName:n="default",scroll:s={x:0,y:0}}){try{let a=this.manager.get("TransitionManager"),c=this.manager.get("PageManager"),o=this.ignoreHashAction,l,p;this.emitter.emit("NAVIGATION_START",{oldHref:e,href:t,trigger:r,transitionName:n,scroll:s}),a.has(n)||(console.log(`[PJAX] transition name "${n}" doesn't exist, switching to the "default" transition`),n="default");try{this.transitionStart(),this.emitter.emit("PAGE_LOADING",{href:t,oldHref:e,trigger:r,scroll:s}),p=await c.load(e),l=await c.load(t),this.emitter.emit("PAGE_LOAD_COMPLETE",{newPage:l,oldPage:p,trigger:r,scroll:s}),p.dom instanceof Element||p.build(),l.build()}catch(u){console.warn("[PJAX] Page load error",u)}try{s=(await a.start(n,{oldPage:p,newPage:l,trigger:r,scroll:s,ignoreHashAction:o})).scroll}catch(u){console.warn("[PJAX] Transition error",u)}this.emitter.emit("NAVIGATION_END",{oldPage:p,newPage:l,trigger:r,transitionName:n,scroll:s})}catch(a){this.forceOnError?this.force(t):console.warn(a)}finally{this.transitionStop()}}onHover(e){let t=this.getLink(e);if(!t||!this.manager.has("PageManager"))return;let r=this.manager.get("PageManager"),n=f(this.getHref(t)),s=n.pathname;if(this.emitter.emit("ANCHOR_HOVER HOVER",e),!O(n.pathname,this.prefetchIgnore)&&!(r.has(s)&&!O(s,r.cacheIgnore)))try{r.load(n),this.emitter.emit("PREFETCH",e)}catch(a){console.warn("[PJAX] Prefetch error",a)}}onStateChange(e){this.go({href:window.location.href,trigger:"popstate",event:e})}initEvents(){this.prefetchIgnore!==!0&&(document.addEventListener("mouseover",this.onHover),document.addEventListener("touchstart",this.onHover)),document.addEventListener("click",this.onClick),window.addEventListener("popstate",this.onStateChange)}stopEvents(){this.prefetchIgnore!==!0&&(document.removeEventListener("mouseover",this.onHover),document.removeEventListener("touchstart",this.onHover)),document.removeEventListener("click",this.onClick),window.removeEventListener("popstate",this.onStateChange)}};var ge=Z(B()),me=class extends b{constructor(e=[]){super();this.routes=new d;for(let t of e)this.add(t)}add({path:e,method:t}){let r=this.parse(e);return this.routes.set(r,t),this}parsePath(e){if(typeof e=="string"||e instanceof RegExp||Array.isArray(e))return(0,ge.pathToRegexp)(e,[],{start:!1,end:!1});if(typeof e=="boolean")return e&&/.*/;throw"[Router] only regular expressions, strings, booleans and arrays of regular expressions and strings are accepted as paths."}isPath(e){return typeof e=="string"||e instanceof RegExp||typeof e=="boolean"||Array.isArray(e)}parse(e){let t=e,r={from:/.*/,to:/.*/};if(this.isPath(e))r={from:!0,to:e};else if(this.isPath(t.from)&&this.isPath(t.to))r=Object.assign({},r,t);else throw"[Router] path is neither a string, regular expression, or a { from, to } object.";let{from:n,to:s}=r;return{from:this.parsePath(n),to:this.parsePath(s)}}route(){if(this.manager.has("HistoryManager")){let e=this.manager.get("HistoryManager"),t=v(f((e.length>1?e.previous:e.current).url)),r=v(f());this.routes.forEach((n,s)=>{let a=s.from,c=s.to;if(typeof a=="boolean"&&typeof c=="boolean")throw`[Router] path ({ from: ${a}, to: ${c} }) is not valid, remember paths can only be strings, regular expressions, or a boolean; however, both the from and to paths cannot be both booleans.`;let o=a,l=c;a instanceof RegExp&&a.test(t)&&(o=a.exec(t)),c instanceof RegExp&&c.test(r)&&(l=c.exec(r)),(Array.isArray(l)&&Array.isArray(o)||Array.isArray(l)&&o==!1&&!c.test(t)||Array.isArray(o)&&l==!1&&!a.test(r))&&n({from:o,to:l,path:{from:t,to:r}})})}else console.warn("[Route] HistoryManager is missing.")}initEvents(){this.emitter.on("READY",this.route,this),this.emitter.on("CONTENT_REPLACED",this.route,this)}stopEvents(){this.emitter.off("READY",this.route,this),this.emitter.off("CONTENT_REPLACED",this.route,this)}};0&&(module.exports={AdvancedManager,App,CONFIG_DEFAULTS,HistoryManager,Manager,ManagerItem,PARSER,PJAX,Page,PageManager,Router,Service,ServiceManager,TRANSITION_REPLACE,TransitionManager,changeState,clean,equal,getHash,getHashedPath,hashAction,ignoreURLs,methodCall,newConfig,newCoords,newState,newURL,toAttr});
