var M=class{constructor(e){this.map=new Map(e)}getMap(){return this.map}get(e){return this.map.get(e)}keys(){return Array.from(this.map.keys())}values(){return Array.from(this.map.values())}set(e,t){return this.map.set(e,t),this}add(e){let n=this.size;return this.set(n,e),this}get size(){return this.map.size}get length(){return this.map.size}last(e=1){let t=this.keys()[this.size-e];return this.get(t)}delete(e){return this.map.delete(e)}remove(e){return this.map.delete(e),this}clear(){return this.map.clear(),this}has(e){return this.map.has(e)}entries(){return this.map.entries()}forEach(e,t){return this.map.forEach(e,t),this}[Symbol.iterator](){return this.entries()}},G=(i,e,...t)=>{i.forEach(n=>{n[e](...t)})};var $=({callback:i=()=>{},scope:e=null,name:t="event"})=>({callback:i,scope:e,name:t}),V=class extends M{constructor(e="event"){super();this.name=e}},X=class extends M{constructor(){super()}getEvent(e){let t=this.get(e);return t instanceof V?t:(this.set(e,new V(e)),this.get(e))}newListener(e,t,n){let r=this.getEvent(e);return r.add($({name:e,callback:t,scope:n})),r}on(e,t,n){if(typeof e=="undefined"||e==null)return this;typeof e=="string"&&(e=e.trim().split(/\s/g));let r,s,a=typeof e=="object"&&!Array.isArray(e),o=a?t:n;return a||(s=t),Object.keys(e).forEach(p=>{r=a?p:e[p],a&&(s=e[p]),this.newListener(r,s,o)},this),this}removeListener(e,t,n){let r=this.get(e);if(r instanceof V&&t){let s=$({name:e,callback:t,scope:n});r.forEach((a,o)=>{if(a.callback===s.callback&&a.scope===s.scope)return r.remove(o)})}return r}off(e,t,n){if(typeof e=="undefined"||e==null)return this;typeof e=="string"&&(e=e.trim().split(/\s/g));let r,s,a=typeof e=="object"&&!Array.isArray(e),o=a?t:n;return a||(s=t),Object.keys(e).forEach(p=>{r=a?p:e[p],a&&(s=e[p]),typeof s=="function"?this.removeListener(r,s,o):this.remove(r)},this),this}once(e,t,n){if(typeof e=="undefined"||e==null)return this;typeof e=="string"&&(e=e.trim().split(/\s/g));let r=typeof e=="object"&&!Array.isArray(e);return Object.keys(e).forEach(s=>{let a=r?s:e[s],o=r?e[s]:t,p=r?t:n,l=(...f)=>{o.apply(p,f),this.removeListener(a,l,p)};this.newListener(a,l,p)},this),this}emit(e,...t){return typeof e=="undefined"||e==null?this:(typeof e=="string"&&(e=e.trim().split(/\s/g)),e.forEach(n=>{let r=this.get(n);r instanceof V&&r.forEach(s=>{let{callback:a,scope:o}=s;a.apply(o,t)})},this),this)}clear(){return G(this,"clear"),super.clear(),this}};var D=i=>typeof i=="string"?i.includes("%")?parseFloat(i)/100:i=="from"?0:i=="to"?1:parseFloat(i):i,R=i=>{let e=new Set,t=Object.keys(i),n=t.length;for(let r=0;r<n;r++){let s=""+t[r],a=i[s],o=s.split(","),p=o.length;for(let l=0;l<p;l++){let f=D(o[l]);e.add({...a,offset:f})}}return[...e].sort((r,s)=>r.offset-s.offset)},Te={};var U=(i="")=>e=>typeof e=="string"?e:`${e}${i}`,z=U(),F=U("px"),Y=U("deg"),q=i=>Array.isArray(i)||typeof i=="string"?(typeof i=="string"&&(i=i.split(",")),i):[i],L=i=>Array.isArray(i)||typeof i=="string"?Boolean(i.length):i!=null&&i!=null,v=i=>e=>L(e)?q(e).map(t=>{if(typeof t!="number"&&typeof t!="string")return t;let n=Number(t),r=Number.isNaN(n)?typeof t=="string"?t.trim():t:n;return i(r)}):[],le=(...i)=>{let e=0;i=i.map(r=>{let s=q(r),a=s.length;return a>e&&(e=a),s});let t=[],n=i.length;for(let r=0;r<e;r++){t[r]=[];for(let s=0;s<n;s++){let a=i[s][r];L(a)&&(t[r][s]=a)}}return t},w=(i,e)=>q(i).map(v(e)),B=["translate","translate3d","translateX","translateY","translateZ","rotate","rotate3d","rotateX","rotateY","rotateZ","scale","scale3d","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective"],J=i=>{let e="",t=B.length;for(let n=0;n<t;n++){let r=B[n],s=i[n];L(s)&&(e+=`${r}(${Array.isArray(s)?s.join(", "):s}) `)}return e.trim()},K=v(z),k=v(F),S=v(Y),pe=i=>i.includes("--")?i:`${i}`.replace(/-([a-z])/g,(t,n)=>n.toUpperCase()),Q=i=>{let e=Object.keys(i),t,n,r={};for(let s=0,a=e.length;s<a;s++)t=pe(e[s]),n=i[e[s]],r[t]=n;return r},_=i=>""+i,ee=["margin","padding","size","width","height","left","right","top","bottom","radius","gap","basis","inset","outline-offset","perspective","thickness","position","distance","spacing"].join("|"),te=i=>{let{perspective:e,rotate:t,rotate3d:n,rotateX:r,rotateY:s,rotateZ:a,translate:o,translate3d:p,translateX:l,translateY:f,translateZ:b,scale:g,scale3d:h,scaleX:u,scaleY:c,scaleZ:m,skew:y,skewX:d,skewY:T,...x}=Q(i);o=w(o,F),p=w(p,F),l=k(l),f=k(f),b=k(b),t=w(t,Y),n=w(n,z),r=S(r),s=S(s),a=S(a),g=w(g,z),h=w(h,z),u=K(u),c=K(c),m=K(m),y=w(y,Y),d=S(d),T=S(T),e=k(e);let E=le(o,p,l,f,b,t,n,r,s,a,g,h,u,c,m,y,d,T,e).filter(L).map(J);return x=j(x,(C,O)=>{let A;if(!/color/gi.test(O)){let P=/rotate/gi.test(O),I=new RegExp(ee,"gi").test(O);if(P||I)return P?A=S:I&&(A=k),A(C).map(ae=>{let oe=ae.trim().split(" ");return A(oe).join(" ")})}return[].concat(C).map(_)}),Object.assign({},L(E)?{transform:E}:null,x)},ie=i=>i.map(e=>{let{translate:t,translate3d:n,translateX:r,translateY:s,translateZ:a,rotate:o,rotate3d:p,rotateX:l,rotateY:f,rotateZ:b,scale:g,scale3d:h,scaleX:u,scaleY:c,scaleZ:m,skew:y,skewX:d,skewY:T,perspective:x,easing:E,iterations:C,offset:O,...A}=Q(e);return t=k(t),n=k(n),r=k(r)[0],s=k(s)[0],a=k(a)[0],o=S(o),p=K(p),l=S(l)[0],f=S(f)[0],b=S(b)[0],g=K(g),h=K(h),u=K(u)[0],c=K(c)[0],m=K(m)[0],y=S(y),d=S(d)[0],T=S(T)[0],x=k(x)[0],[A,t,n,r,s,a,o,p,l,f,b,g,h,u,c,m,y,d,T,x]}).map(([e,...t])=>{let n=J(t);return e=j(e,(r,s)=>{let a;if(!/color/gi.test(s)){let o=/rotate/gi.test(s),p=new RegExp(ee,"gi").test(s);if(o||p){o?a=S:p&&(a=k);let l=_(r).trim().split(" ");return a(l).join(" ")}}return _(r)}),Object.assign({},L(n)?{transform:n}:null,e)});var me=i=>typeof i=="string"?Array.from(document.querySelectorAll(i)):[i],ue=i=>[].concat(...i),W=i=>Array.isArray(i)?ue(i.map(W)):typeof i=="string"||i instanceof Node?me(i):i instanceof NodeList||i instanceof HTMLCollection?Array.from(i):[],ce=(i,e,t)=>typeof i=="function"?i.apply(t,e):i,j=(i,e)=>{let t=Object.keys(i),n,r,s={};for(let a=0,o=t.length;a<o;a++)n=t[a],r=i[n],s[n]=e(r,n,i);return s},ne=(i,e,t)=>j(i,n=>ce(n,e,t)),re={in:"ease-in",out:"ease-out","in-out":"ease-in-out","in-sine":"cubic-bezier(0.47, 0, 0.745, 0.715)","out-sine":"cubic-bezier(0.39, 0.575, 0.565, 1)","in-out-sine":"cubic-bezier(0.445, 0.05, 0.55, 0.95)","in-quad":"cubic-bezier(0.55, 0.085, 0.68, 0.53)","out-quad":"cubic-bezier(0.25, 0.46, 0.45, 0.94)","in-out-quad":"cubic-bezier(0.455, 0.03, 0.515, 0.955)","in-cubic":"cubic-bezier(0.55, 0.055, 0.675, 0.19)","out-cubic":"cubic-bezier(0.215, 0.61, 0.355, 1)","in-out-cubic":"cubic-bezier(0.645, 0.045, 0.355, 1)","in-quart":"cubic-bezier(0.895, 0.03, 0.685, 0.22)","out-quart":"cubic-bezier(0.165, 0.84, 0.44, 1)","in-out-quart":"cubic-bezier(0.77, 0, 0.175, 1)","in-quint":"cubic-bezier(0.755, 0.05, 0.855, 0.06)","out-quint":"cubic-bezier(0.23, 1, 0.32, 1)","in-out-quint":"cubic-bezier(0.86, 0, 0.07, 1)","in-expo":"cubic-bezier(0.95, 0.05, 0.795, 0.035)","out-expo":"cubic-bezier(0.19, 1, 0.22, 1)","in-out-expo":"cubic-bezier(1, 0, 0, 1)","in-circ":"cubic-bezier(0.6, 0.04, 0.98, 0.335)","out-circ":"cubic-bezier(0.075, 0.82, 0.165, 1)","in-out-circ":"cubic-bezier(0.785, 0.135, 0.15, 0.86)","in-back":"cubic-bezier(0.6, -0.28, 0.735, 0.045)","out-back":"cubic-bezier(0.175, 0.885, 0.32, 1.275)","in-out-back":"cubic-bezier(0.68, -0.55, 0.265, 1.55)"},fe=Object.keys(re),se=i=>{let e=i.replace(/^ease-/,"");return fe.includes(e)?re[e]:i},ye={keyframes:[],offset:[],loop:1,delay:0,speed:1,endDelay:0,easing:"ease",timelineOffset:0,autoplay:!0,duration:1e3,fillMode:"none",direction:"normal",padEndDelay:!1,timeline:document.timeline,extend:{}},he=i=>{let{options:e,...t}=i,n=e instanceof H?e.options:Array.isArray(e)?e?.[0]?.options:e;return Object.assign({},n,t)},N=(i,e)=>{let t={...e};for(;i.length;){let{[i.pop()]:n,...r}=t;t=r}return t},Z=class{constructor(e){this.options={};this.properties={};this.totalDuration=-Infinity;this.minDelay=Infinity;this.maxSpeed=Infinity;this.emitter=new X;this.targets=new M;this.targetIndexes=new WeakMap;this.keyframeEffects=new WeakMap;this.computedOptions=new WeakMap;this.animations=new WeakMap;this.computedKeyframes=new WeakMap;this.loop=this.loop.bind(this),this.onVisibilityChange=this.onVisibilityChange.bind(this),this.on("error",console.error),this.updateOptions(e),this.mainAnimation&&(this.visibilityPlayState=this.getPlayState(),Z.pauseOnPageHidden&&document.addEventListener("visibilitychange",this.onVisibilityChange,!1)),this.newPromise()}onVisibilityChange(){document.hidden?(this.visibilityPlayState=this.getPlayState(),this.is("running")&&(this.loop(),this.pause())):this.visibilityPlayState=="running"&&this.is("paused")&&this.play()}newPromise(){return this.promise=new Promise((e,t)=>{this?.emitter?.once?.("finish",()=>e([this])),this?.emitter?.once?.("error",n=>t(n))}),this.promise}then(e,t){return e=e?.bind(this),t=t?.bind(this),this?.promise?.then?.(e,t),this}catch(e){return e=e?.bind(this),this.promise?.catch?.(e),this}finally(e){return e=e?.bind(this),this.promise?.finally?.(e),this}loop(){this.stopLoop(),this.animationFrame=window.requestAnimationFrame(this.loop),this.emit("update",this.getProgress(),this)}stopLoop(){window.cancelAnimationFrame(this.animationFrame)}allAnimations(e){return this.targets.forEach(t=>{let n=this.keyframeEffects.get(t),r=this.animations.get(n);return e(r,t)}),this}all(e){return this.mainAnimation&&e(this.mainAnimation,this.mainElement),this.allAnimations(e),this}beginEvent(){this.getProgress()==0&&this.emit("begin",this)}play(){let e=this.getPlayState();return this.beginEvent(),this.all(t=>t.play()),this.emit("play",e,this),this.is(e)||this.emit("playstate-change",e,this),this.loop(),this}pause(){let e=this.getPlayState();return this.all(t=>t.pause()),this.emit("pause",e,this),this.is(e)||this.emit("playstate-change",e,this),this.stopLoop(),this}reverse(){return this.all(e=>e.reverse()),this}reset(){return this.setProgress(0),this.options.autoplay?this.play():this.pause(),this}cancel(){return this.all(e=>e.cancel()),this}finish(){return this.all(e=>e.finish()),this}stop(){this.cancel(),this.stopLoop(),document.removeEventListener("visibilitychange",this.onVisibilityChange,!1),this.targets.forEach(e=>this.removeTarget(e)),this.emit("stop"),this.emitter.clear(),this.mainkeyframeEffect=null,this.mainAnimation=null,this.mainElement=null,this.promise=null,this.computedOptions=null,this.animations=null,this.keyframeEffects=null,this.emitter=null,this.targets=null,this.options=null,this.properties=null}getAnimation(e){let t=this.keyframeEffects.get(e);return this.animations.get(t)}getTiming(e){let t=this.computedOptions.get(e)??{},n=this.keyframeEffects.get(e).getTiming?.()??{};return{...t,...n}}getCurrentTime(){return this.mainAnimation.currentTime}getProgress(){return this.getCurrentTime()/this.totalDuration*100}getSpeed(){return this.mainAnimation.playbackRate}getPlayState(){return this.mainAnimation.playState}is(e){return this.getPlayState()==e}setCurrentTime(e){return this.all(t=>t.currentTime=e),this.emit("update",this.getProgress()),this}setProgress(e){let t=e/100*this.totalDuration;return this.setCurrentTime(t),this}setSpeed(e=1){return this.maxSpeed=e,this.all(t=>{t.updatePlaybackRate?t.updatePlaybackRate(e):t.playbackRate=e}),this}createArrayOfComputedOptions(e,t){let n=[];return this.targets.forEach((r,s)=>{let a=this.computedOptions.get(r)??{},o=d=>{let T=d;return d=="loop"&&(T="iterations"),d=="fillMode"&&(T="fill"),e[d]??a[T]??this.options[d]},p=Object.assign({easing:o("easing"),iterations:o("loop"),direction:o("direction"),endDelay:o("endDelay"),duration:o("duration"),speed:o("speed"),delay:o("delay"),timelineOffset:o("timelineOffset"),keyframes:o("keyframes")},o("extend")??{}),l=ne(p,[s,t,r],this);typeof l.easing=="string"&&(l.easing=se(l.easing)),l.iterations===!0&&(l.iterations=Infinity),l.fill=o("fillMode");let{timelineOffset:f,speed:b,endDelay:g,delay:h,duration:u,iterations:c,...m}=l;c=Number(c),u=Number(u),g=Number(g),b=Number(b),h=Number(h)+Number(f);let y=h+u*c+g;this.totalDuration<y&&(this.totalDuration=y),n[s]={...m,speed:b,tempDurations:y,endDelay:g,delay:h,duration:u,iterations:c},this.minDelay>h&&(this.minDelay=h),this.maxSpeed>b&&(this.maxSpeed=b)}),n}createAnimations(e,t){let{arrOfComputedOptions:n,padEndDelay:r,oldCSSProperties:s,onfinish:a,oncancel:o,timeline:p}=e;this.targets.forEach((l,f)=>{let{speed:b,keyframes:g,tempDurations:h,...u}=n[f];r&&u.endDelay==0&&Math.abs(u.iterations)!=Math.abs(Infinity)&&(u.endDelay=this.totalDuration-h);let c,m,y=g;typeof y=="object"&&(y=R(y));let d=this.computedKeyframes.get(l)??{},T=Object.assign({},s,d),x=j(T,(O,A)=>this.properties[A]??O);if(m=L(y)?y:x,Array.isArray(m))c=m.map(O=>{let{easing:A,offset:P,...I}=N(["speed","loop"],O);return Object.assign({},I,typeof A=="string"?{easing:se(A)}:null,typeof P=="string"||typeof P=="number"?{offset:D(P)}:null)}),c=ie(c);else{let O=N(["keyframes"],m),{offset:A,...P}=ne(O,[f,t,l],this);P=te(P);let I=A;c=Object.assign({},P,L(I)?{offset:I.map(D)}:null)}let E,C;this.keyframeEffects.has(l)?(C=this.keyframeEffects.get(l),E=this.animations.get(C),C?.setKeyframes?.(c),C?.updateTiming?.(u)):(C=new KeyframeEffect(l,c,u),E=new Animation(C,p),this.keyframeEffects.set(l,C),this.animations.set(C,E)),E.playbackRate=b,E.onfinish=()=>{typeof a=="function"&&a.call(this,l,f,t,E)},E.oncancel=()=>{typeof o=="function"&&o.call(this,l,f,t,E)},this.computedOptions.set(l,u),this.computedKeyframes.set(l,c)})}updateOptions(e={}){try{let t=he(e);this.options=Object.assign({},ye,this.options,t);let n=["easing","loop","endDelay","duration","speed","delay","timelineOffset","direction","extend","fillMode","offset"],{padEndDelay:r,autoplay:s,target:a,targets:o,timeline:p,onfinish:l,oncancel:f,...b}=N(n,this.options);this.properties=N([...n,"keyframes","padEndDelay","onfinish","oncancel","autoplay","target","targets","timeline"],t);let g=this.targets.values(),h=[...new Set([...g,...W(o),...W(a)])];this.targets.clear(),h.forEach((m,y)=>{this.targets.set(y,m),this.targetIndexes.set(m,y)});let u=this.targets.size,c=this.createArrayOfComputedOptions(t,u);if(this.createAnimations({arrOfComputedOptions:c,padEndDelay:r,oldCSSProperties:b,onfinish:l,oncancel:f,timeline:p},u),u<=0&&(this.maxSpeed==Infinity&&(this.maxSpeed=Number(this.options.speed)),this.minDelay==Infinity&&(this.minDelay=Number(this.options.delay)+Number(this.options.timelineOffset)),this.totalDuration==-Infinity&&(this.totalDuration=Number(this.options.duration))),this.mainAnimation?(this.mainkeyframeEffect?.updateTiming?.({duration:this.totalDuration}),(!this.mainkeyframeEffect.setKeyframes||!this.mainkeyframeEffect.updateTiming)&&console.warn("@okikio/animate - `KeyframeEffect.setKeyframes` and/or `KeyframeEffect.updateTiming` are not supported in this browser.")):(this.mainkeyframeEffect=new KeyframeEffect(this.mainElement,null,{duration:this.totalDuration}),this.mainAnimation=new Animation(this.mainkeyframeEffect,p)),this.mainAnimation.playbackRate=this.maxSpeed,this.mainAnimation.onfinish=()=>{if(this.mainAnimation){let m=this.getPlayState();this.is(m)||this.emit("playstate-change",m,this),this.loop(),this.stopLoop()}this.emit("finish",this)},this.mainAnimation.oncancel=()=>{if(this.mainAnimation){let m=this.getPlayState();this.is(m)||this.emit("playstate-change",m,this),this.loop(),this.stopLoop()}this.emit("cancel",this)},s){let m=window.setTimeout(()=>{this.emit("begin",this),m=window.clearTimeout(m)},0);this.play()}else this.pause()}catch(t){this.emit("error",t)}}add(e){let t=this.getProgress(),n=this.is("running"),r=this.is("paused");this.updateOptions({target:e}),this.setProgress(t),n?this.play():r&&this.pause()}removeTarget(e){let t=this.keyframeEffects.get(e);this.animations.delete(t),t=null,this.computedKeyframes.delete(e),this.computedOptions.delete(e),this.keyframeEffects.delete(e);let n=this.targetIndexes.get(e);this.targets.delete(n),this.targetIndexes.delete(e)}remove(e){this.removeTarget(e);let t=new Set([].concat(this.targets.values()));this.options.target=[...t],this.options.targets=[],t.clear(),t=null;let n=this.getProgress(),r=this.is("running"),s=this.is("paused");this.updateOptions(),r?this.play():s&&this.pause(),this.setProgress(n)}on(e,t,n){return this?.emitter?.on(e,t,n??this),this}off(e,t,n){return this?.emitter?.off(e,t,n??this),this}emit(e,...t){return this?.emitter?.emit(e,...t),this}toJSON(){return this.options}get[Symbol.toStringTag](){return"Animate"}},H=Z;H.pauseOnPageHidden=!0;var be=(i={})=>new H(i),Ie=be;export{H as Animate,w as CSSArrValue,ee as CSSPXDataType,v as CSSValue,ye as DefaultAnimationOptions,re as EASINGS,Te as EFFECTS,fe as EasingKeys,se as GetEase,R as KeyframeParse,Q as ParseCSSProperties,ie as ParseTransformableCSSKeyframes,te as ParseTransformableCSSProperties,B as TransformFunctionNames,Y as UnitDEG,S as UnitDEGCSSValue,z as UnitLess,K as UnitLessCSSValue,F as UnitPX,k as UnitPXCSSValue,U as addCSSUnit,be as animate,pe as camelCase,ce as computeOption,J as createTransformProperty,Ie as default,ue as flatten,me as getElements,W as getTargets,L as isValid,ne as mapAnimationOptions,j as mapObject,N as omit,D as parseOffset,he as parseOptions,q as toArr,_ as toStr,le as transpose};
