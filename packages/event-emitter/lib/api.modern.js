"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var t,e=(function(t,e){t.exports=function(){function t(t){var e;if("undefined"!=typeof Symbol){if(Symbol.asyncIterator&&null!=(e=t[Symbol.asyncIterator]))return e.call(t);if(Symbol.iterator&&null!=(e=t[Symbol.iterator]))return e.call(t)}throw new TypeError("Object is not async iterable")}function e(t,n,i){if(!t.s){if(i instanceof r){if(!i.s)return void(i.o=e.bind(null,t,n));1&n&&(n=i.s),i=i.v}if(i&&i.then)return void i.then(e.bind(null,t,n),e.bind(null,t,2));t.s=n,t.v=i;var o=t.o;o&&o(t)}}var n=function(){function e(t){this.map=new Map(t)}var n,r=e.prototype;return r.getMap=function(){return this.map},r.get=function(t){return this.map.get(t)},r.keys=function(){return[].concat(this.map.keys())},r.values=function(){return[].concat(this.map.values())},r.set=function(t,e){return this.map.set(t,e),this},r.add=function(t){return this.set(this.size,t),this},r.last=function(t){void 0===t&&(t=1);var e=this.keys()[this.size-t];return this.get(e)},r.prev=function(){return this.last(2)},r.delete=function(t){return this.map.delete(t),this},r.clear=function(){return this.map.clear(),this},r.has=function(t){return this.map.has(t)},r.entries=function(){return this.map.entries()},r.forEach=function(t,e){return void 0===t&&(t=function(){}),this.map.forEach(t,e),this},r[Symbol.iterator]=function(){return this.entries()},r.methodCall=function(t){var e=arguments;return this.forEach(function(n){n[t].apply(n,[].slice.call(e,1))}),this},r.asyncMethodCall=function(e){try{var n,r,i,c,a,h=this,l=arguments,f=!0,v=!1,p=u(function(){return s(function(){r=t(h.map);var n=o(function(){return!!Promise.resolve(r.next()).then(function(t){return f=i.done,i=t,Promise.resolve(i.value).then(function(t){return c=t,!f})})},function(){return!!(f=!0)},function(){var t=c[1];return Promise.resolve(t[e].apply(t,[].slice.call(l,1))).then(function(){})});if(n&&n.then)return n.then(function(){})},function(t){v=!0,a=t})},function(t,e){function i(r){if(n)return r;if(t)throw e;return e}var o=u(function(){var t=function(){if(!f&&null!=r.return)return Promise.resolve(r.return()).then(function(){})}();if(t&&t.then)return t.then(function(){})},function(t,e){if(v)throw a;if(t)throw e;return e});return o&&o.then?o.then(i):i(o)});return Promise.resolve(p&&p.then?p.then(function(t){return n?t:h}):n?p:h)}catch(t){return Promise.reject(t)}},(n=[{key:"size",get:function(){return this.map.size}}])&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(e.prototype,n),e}(),r=function(){function t(){}return t.prototype.then=function(n,r){var i=new t,o=this.s;if(o){var s=1&o?n:r;if(s){try{e(i,1,s(this.v))}catch(t){e(i,2,t)}return i}return this}return this.o=function(t){try{var o=t.v;1&t.s?e(i,1,n?n(o):o):r?e(i,1,r(o)):e(i,2,o)}catch(t){e(i,2,t)}},i},t}();function i(t){return t instanceof r&&1&t.s}function o(t,n,o){for(var s;;){var u=t();if(i(u)&&(u=u.v),!u)return c;if(u.then){s=0;break}var c=o();if(c&&c.then){if(!i(c)){s=1;break}c=c.s}if(n){var a=n();if(a&&a.then&&!i(a)){s=2;break}}}var h=new r,l=e.bind(null,h,2);return(0===s?u.then(v):1===s?c.then(f):a.then(p)).then(void 0,l),h;function f(r){c=r;do{if(n&&(a=n())&&a.then&&!i(a))return void a.then(p).then(void 0,l);if(!(u=t())||i(u)&&!u.v)return void e(h,1,c);if(u.then)return void u.then(v).then(void 0,l);i(c=o())&&(c=c.v)}while(!c||!c.then);c.then(f).then(void 0,l)}function v(t){t?(c=o())&&c.then?c.then(f).then(void 0,l):f(c):e(h,1,c)}function p(){(u=t())?u.then?u.then(v).then(void 0,l):v(u):e(h,1,c)}}function s(t,e){try{var n=t()}catch(t){return e(t)}return n&&n.then?n.then(void 0,e):n}function u(t,e){try{var n=t()}catch(t){return e(!0,t)}return n&&n.then?n.then(e.bind(null,!1),e.bind(null,!0)):e(!1,n)}return n}()}(t={path:void 0,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()}}),t.exports);class n{constructor({callback:t=(()=>{}),scope:e=null,name:n="event"}){this.listener={callback:t,scope:e,name:n}}getCallback(){return this.listener.callback}getScope(){return this.listener.scope}getEventName(){return this.listener.name}toJSON(){return this.listener}}class r extends e{constructor(t="event"){super(),this.name=t}}class i extends e{constructor(){super()}getEvent(t){let e=this.get(t);return e instanceof r?e:(this.set(t,new r(t)),this.get(t))}newListener(t,e,r){let i=this.getEvent(t);return i.add(new n({name:t,callback:e,scope:r})),i}on(t,e,n){if(void 0===t)return this;let r,i,o;return"string"==typeof t&&(t=t.split(/\s/g)),Object.keys(t).forEach(s=>{"object"!=typeof t||Array.isArray(t)?(r=t[s],i=e,o=n):(r=s,i=t[s],o=e),this.newListener(r,i,o)},this),this}removeListener(t,e,r){let i=this.getEvent(t);if(e){let o,s=0,u=i.size,c=new n({name:t,callback:e,scope:r});for(;s<u&&(o=i.get(s),console.log(o),o.getCallback()!==c.getCallback()||o.getScope()!==c.getScope());s++);i.delete(s)}return i}off(t,e,n){if(void 0===t)return this;let r,i,o;return"string"==typeof t&&(t=t.split(/\s/g)),Object.keys(t).forEach(s=>{"object"!=typeof t||Array.isArray(t)?(r=t[s],i=e,o=n):(r=s,i=t[s],o=e),i?this.removeListener(r,i,o):this.delete(r)},this),this}once(t,e,n){if(void 0===t)return this;"string"==typeof t&&(t=t.split(/\s/g));let r=(...i)=>{this.off(t,r,n),e.apply(n,i)};return this.on(t,r,n),this}emit(t,...e){return void 0===t||("string"==typeof t&&(t=t.split(/\s/g)),t.forEach(t=>{let n=this.getEvent(t);const r=new CustomEvent(t,{detail:e});window.dispatchEvent(r),n.forEach(t=>{let{callback:n,scope:r}=t.toJSON();n.apply(r,e)})},this)),this}}export{r as Event,i as EventEmitter,n as Listener};
//# sourceMappingURL=api.modern.js.map
